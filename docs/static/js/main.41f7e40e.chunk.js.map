{"version":3,"sources":["utils.ts","components/PopupEditor.tsx","components/VegaLiteEditor.tsx","components/TooltipTable.tsx","components/VegaLite.tsx","components/SpecPreview.tsx","variables.ts","components/NavigationBar.tsx","components/NewSpec.tsx","components/views/ViewComponent.tsx","components/views/UnitComponent.tsx","components/views/LayerComponent.tsx","components/views/ConcatComponent.tsx","components/views/FacetComponent.tsx","components/views/RepeatConponent.tsx","components/views/Renderer.tsx","components/MainView.tsx","SyntaxTree/Utils.ts","SyntaxTree/View.ts","SyntaxTree/LayerView.ts","components/operations/Utils.tsx","components/operations/LayerButton.tsx","components/operations/ConcatButton.tsx","SyntaxTree/RepeatView.ts","components/popups/PopupRepeatOption.tsx","components/operations/RepeatButton.tsx","SyntaxTree/FacetView.ts","components/popups/PopupFacetOption.tsx","components/operations/FacetButton.tsx","components/operations/PlaceButton.tsx","components/operations/ExportButton.tsx","components/popups/ViewPreview.tsx","components/popups/PopupConcatOption.tsx","components/popups/PopupLayerOption.tsx","components/operations/EditButton.tsx","components/OperationBar.tsx","SyntaxTree/ConcatView.ts","store.ts","components/InnerSpecNevigator.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["failure","x","tag","value","addMarkdownProps","key","description","markdownDescription","hasOwnProperty","vegaLiteSchema","useStyles","makeStyles","theme","textField","marginTop","spacing","marginBottom","width","closeButton","position","right","top","errorMessage","fontStyle","color","schema","uri","PopupEditor","_ref","isOpen","onClose","onChange","alias","setAlias","errorMsg","extras","classes","react_default","a","createElement","Dialog","open","aria-labelledby","maxWidth","fullWidth","DialogTitle","disableTypography","TextField","id","label","className","event","target","margin","Button","onClick","Save_default","IconButton","Close_default","DialogContent","lib_default","language","height","editorDidMount","editor","focus","editorWillMount","monaco","languages","json","jsonDefaults","setDiagnosticsOptions","allowComments","enableSchemaRequest","schemas","validate","options","automaticLayout","cursorBlinking","folding","lineNumbersMinChars","minimap","enabled","scrollBeyondLastLine","wordWrap","Fragment","examples","$schema","data","url","mark","encoding","field","type","y","extent","transform","filter","scale","rangeStep","aggregate","axis","title","stringToSpec","JSON","parse","vl","e","message","VegaLiteEditor","showModal","setShowModal","setValue","onSuccess","_useState","useState","_useState2","Object","slicedToArray","setErrorMsg","map","example","i","stringify","PopupEditor_PopupEditor","toSave","result","txt","_","keyColumn","textAlign","TooltipTable","table","children","_ref2","_ref3","val","Tooltip","placement","VegaLite","React","memo","NativeVegaLite","xSpec","spec","xRest","objectWithoutProperties","ySpec","yRest","shallowEqual","Vega","isSameSpec","wrapper","&::after","display","sidebarWidth","backgroundImage","content","bottom","alignSelf","image","overflow","preview","userSelect","marginLeft","marginRight","border","borderColor","active","borderStyle","&:hover","&:active","cursor","center","left","& button","SpecPreview","_useState3","_useState4","currentSpec","setCurrentSpec","_useState5","_useState6","currentAlias","setCurrentAlias","_useState7","_useState8","isDeleting","setIsDeleting","dispatch","useDispatch","useSelector","state","current","operands","includes","getCompositeViewType","ListItem","disableGutters","operand","TooltipTable_TooltipTable","Fab","size","Edit_default","onMouseEnter","onMouseLeave","Delete_default","VegaLiteEditor_VegaLiteEditor","layer","concat","hconcat","vconcat","facet","list","overflowY","overflowX","flexGrow","paddingTop","paddingBottom","flexDirection","alignContent","NavigationBar","specs","List","SpecPreview_SpecPreview","button","NewSpec","PlaylistAdd_default","main","padding","status","isActive","toHover","backgroundColor","justifyContent","alignItems","makeViewComponent","View","view","setIsHovering","thisId","isHoveringChild","setIsHoveringChild","isOperandIncluded","UnitComponent","export","LayerComponent","ConcatComponent","concatView","subViews","getSubViews","style","getOrient","subView","render","FacetComponent","RepeatComponent","Renderer","Error","getRenderer","palette","grey","emptyView","fontSize","MainView","tree","moveElement","arr","from","to","length","fromElm","containsDifferentData","datasets","getData","isUnitSpec","isRepeatSpec","isFacetSpec","toConsumableArray","isLayerSpec","isConcatSpec","isHConcatSpec","isVConcatSpec","innerSpec","flat","check","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","dataset","R","err","return","extractData","_extractData","newSpec","_extractData2","extractedData","extractedSpec","outputData","_extractData3","push","apply","jsonCopy","findViewInArray","views","currentView","parent","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","findView","objectSpread","replaceViewInArray","obj","idCounter","classCallCheck","this","_id","_type","createClass","get","CompositeView","_View","possibleConstructorReturn","getPrototypeOf","arguments","inherits","UnitView","_View2","_this","call","cloned","_view","LayerView","_CompositeView","l","unshift","index","splice","deepClone","getEncoding","operateFactory","operator","extra","buttonNormal","buttonWarn","error","LayerButton","navBarOperands","mainViewOperands","operate","anchorEl","setAnchorEl","layerDisabled","mainViewOperand","layerDisabledCheck","layerWarn","encodings","mainViewEncodings","currentEncodingField","currentEncodingType","_i","_Object$keys","keys","layerWarnCheck","handleClickLayer","currentTarget","handleSelectOption","option","handleMenuClose","aria-owns","aria-haspopup","ErrorOutlineOutlined_default","ArrowDropDown_default","disabled","Menu","Boolean","anchorOrigin","vertical","horizontal","transformOrigin","MenuItem","ConcatButton","orient","concatDisabled","RepeatView","repeatInfo","repeat","applyRepeat","channel","addAxis","removeAxis","isRepeating","remove","clone","info","RepeatInfo","row","column","rowChannel","columnChannel","nestedTypes","nestedType","forEach","_jsonCopy","nestedSpecs","output","_toPropertyKey","nestedSpec","applyRepeatToEncoding","fieldText","minWidth","fieldTexts","addAndRemove","checkBox","axisConfig","PopupRepeatOption","currentRepeat","checkRow","setCheckRow","checkColumn","setCheckColumn","rowFields","setRowFields","setRowChannel","_useState9","_useState10","columnFields","setColumnFields","_useState11","_useState12","setColumnChannel","handleTextChangeFactory","setter","newFields","axisConfigFactory","checkSetter","channelSetter","fields","fieldsSetter","Checkbox","checked","Add_default","Remove_default","onEntering","DialogContentText","DialogActions","autoFocus","RepeatButton","useWarningStyles","setIsOpen","repeatDisabled","repeatWarn","PopupRepeatOption_PopupRepeatOption","FacetView","facetInfo","swapAxis","FacetInfo","typeSelector","PopupFacetOption","currentFacet","rowField","setRowField","rowType","setRowType","columnField","setColumnField","columnType","setColumnType","fieldSetter","typeSetter","FormControl","InputLabel","htmlFor","Select","inputProps","name","FacetButton","facetDisabled","facetWarn","PopupFacetOption_PopupFacetOption","PlaceButton","placeDisabled","toReplace","ExportButton","exportDisabled","element","document","file","Blob","href","URL","createObjectURL","download","body","appendChild","click","Launch_default","ViewPreview","selectedSubViewId","setSelectedSubViewId","direction","actions","paddingLeft","PopupConcatOption","subViewIdsOrder","setSubViewIdsOrder","currentOrient","setCurrentOrient","subViewsMap","setSubViewsMap","operateDisabled","_subViewMap","ViewPreview_ViewPreview","Switch","aria-label","newOrder","ArrowBack_default","ArrowUpward_default","ArrowForward_default","ArrowDownward_default","order","PopupLayerOption","EditButton","isLayerPopupOpen","setIsLayerPopupOpen","isConcatPopupOpen","setIsConcatPopupOpen","isRepeatPopupOpen","setIsRepeatPopupOpen","isFacetPopupOpen","setIsFacetPopupOpen","setCurrentView","setters","unit","alert","PopupLayerOption_PopupLayerOption","PopupConcatOption_PopupConcatOption","getInfo","OperationBar","undoDisabled","undoStack","redoDisabled","redoStack","Grid","container","justify","item","LayerButton_LayerButton","ConcatButton_ConcatButton","RepeatButton_RepeatButton","FacetButton_FacetButton","PlaceButton_PlaceButton","Undo_default","Redo_default","EditButton_EditButton","ExportButton_ExportButton","ConcatView","defineProperty","newGlobalState","oldState","getCurrent","initialState","lastSpecId","store","createStore","globalState","action","rest","slice","findInNav","find","newTree","rightViewResult","leftView","oldViewId","append","replaceChild","_action$extra","assertNever","_view$getSubViews","changeInfo","_ref4","newView","subViewMap","subViewId","console","InnerViewNavigator","toShowInner","setToShowInner","findResult","root","minHeight","App","es","NewSpec_NewSpec","NavigationBar_NavigationBar","OperationBar_OperationBar","MainView_MainView","InnerSpecNevigator_InnerViewNavigator","window","location","hostname","match","ReactDOM","src_App","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.41f7e40e.chunk.js","sourcesContent":["export const success = <T>(x: T): ISuccess<T> => ({ tag: 'success', value: x });\nexport const failure = <T>(x: T): IFailure<T> => ({ tag: 'failure', value: x });\nexport const last = <T>(xs: T[]) => xs[xs.length - 1];\nexport const assertNever = (x: never): never => {\n  throw new Error('Unexpected object: ' + x);\n};\n","import React from 'react';\nimport MonacoEditor, {\n  EditorDidMount,\n  EditorWillMount,\n  DiffChangeHandler,\n} from 'react-monaco-editor';\nimport Close from '@material-ui/icons/Close';\nimport Save from '@material-ui/icons/Save';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { TextField } from '@material-ui/core';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport vegaLiteSchema from 'vega-lite/build/vega-lite-schema.json';\n\n/**\n * Adds markdownDescription props to a schema. See https://github.com/Microsoft/monaco-editor/issues/885\n */\nconst addMarkdownProps = value => {\n  if (typeof value === 'object' && value !== null) {\n    if (value.description) {\n      value.markdownDescription = value.description;\n    }\n\n    for (const key in value) {\n      if (value.hasOwnProperty(key)) {\n        value[key] = addMarkdownProps(value[key]);\n      }\n    }\n  }\n  return value;\n};\n\naddMarkdownProps(vegaLiteSchema);\n\nexport interface IPopupEditorProps {\n  isOpen: boolean;\n  onClose: (toSave: boolean) => void;\n  value: string;\n  onChange: DiffChangeHandler;\n  alias: string;\n  setAlias: (txt: string) => void;\n  errorMsg?: string;\n  extras: React.ReactNode[];\n}\n\nconst editorHeight = 400;\n\nconst useStyles = makeStyles(theme => ({\n  textField: {\n    marginTop: theme.spacing(0),\n    marginBottom: theme.spacing(4),\n    width: 300,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  },\n  errorMessage: {\n    fontStyle: 'italic',\n    color: 'red',\n  },\n}));\n\nconst schema = [\n  {\n    schema: vegaLiteSchema,\n    uri: 'https://vega.github.io/schema/vega-lite/v3.json',\n  },\n];\n\nexport const PopupEditor: React.FC<IPopupEditorProps> = ({\n  isOpen,\n  onClose,\n  value,\n  onChange,\n  alias,\n  setAlias,\n  errorMsg,\n  extras,\n}) => {\n  const classes = useStyles();\n\n  const handleEditorDidMount: EditorDidMount = editor => {\n    editor.focus();\n  };\n\n  const handleEditorWillMount: EditorWillMount = monaco => {\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n      allowComments: false,\n      enableSchemaRequest: true,\n      schemas: schema,\n      validate: true,\n    });\n  };\n\n  return (\n    <Dialog\n      open={isOpen}\n      onClose={onClose}\n      aria-labelledby=\"form-dialog-title\"\n      maxWidth=\"lg\"\n      fullWidth={true}\n    >\n      <DialogTitle disableTypography>\n        <TextField\n          id=\"standard-name\"\n          label=\"Name\"\n          className={classes.textField}\n          value={alias}\n          onChange={event => setAlias(event.target.value)}\n          margin=\"normal\"\n        />\n        <Button onClick={() => onClose(true)}>\n          <Save />\n          &nbsp; Save\n        </Button>\n        {extras}\n        <IconButton\n          className={classes.closeButton}\n          onClick={() => onClose(false)}\n        >\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <div className=\"editor\">\n          <MonacoEditor\n            language=\"json\"\n            value={value}\n            height={editorHeight}\n            onChange={onChange}\n            editorDidMount={handleEditorDidMount}\n            editorWillMount={handleEditorWillMount}\n            options={{\n              automaticLayout: true,\n              cursorBlinking: 'smooth',\n              folding: true,\n              lineNumbersMinChars: 4,\n              minimap: { enabled: false },\n              scrollBeyondLastLine: false,\n              wordWrap: 'on',\n            }}\n          />\n        </div>\n        <span className={classes.errorMessage}>\n          {errorMsg !== null ? <>{errorMsg} &nbsp;</> : null}\n        </span>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","import React, { useState } from 'react';\nimport * as vl from 'vega-lite';\nimport stringify from 'json-stringify-pretty-compact';\nimport Button from '@material-ui/core/Button';\n\nimport { success, failure } from '../utils';\nimport { PopupEditor } from './PopupEditor';\n\nexport interface IVegaLiteEditorProps {\n  showModal: boolean;\n  setShowModal: (val: boolean) => void;\n  value: string;\n  setValue: (txt: string) => void;\n  alias: string;\n  setAlias: (txt: string) => void;\n  onSuccess: (alias: string, json: IRawSpec) => void;\n}\n\nconst examples = [\n  {\n    $schema: 'https://vega.github.io/schema/vega-lite/v3.json',\n    data: { url: 'https://vega.github.io/editor/data/cars.json' },\n    mark: 'point',\n    encoding: {\n      x: { field: 'Horsepower', type: 'quantitative' },\n      y: { field: 'Miles_per_Gallon', type: 'quantitative' },\n    },\n  },\n  {\n    $schema: 'https://vega.github.io/schema/vega-lite/v3.json',\n    data: { url: 'https://vega.github.io/editor/data/cars.json' },\n    mark: { type: 'errorband', extent: 'stdev' },\n    encoding: {\n      y: { field: 'Miles_per_Gallon', type: 'quantitative' },\n    },\n  },\n\n  {\n    $schema: 'https://vega.github.io/schema/vega-lite/v3.json',\n    data: { url: 'https://vega.github.io/editor/data/population.json' },\n    transform: [{ filter: 'datum.year == 2000' }],\n    mark: 'bar',\n    encoding: {\n      y: {\n        field: 'age',\n        type: 'ordinal',\n        scale: { rangeStep: 17 },\n      },\n      x: {\n        aggregate: 'sum',\n        field: 'people',\n        type: 'quantitative',\n        axis: { title: 'population' },\n      },\n    },\n  },\n];\n\nconst stringToSpec = (value: string) => {\n  try {\n    const json = JSON.parse(value);\n    if (!('data' in json) || !('url' in json.data || 'values' in json.data)) {\n      return failure('data field must exist and must be url.');\n    }\n\n    // TODO: can we do anything with the output of the compilation?\n    // currently we only call it for side-effect (to see if it errors or not)\n    vl.compile(json);\n    return success(json);\n  } catch (e) {\n    return failure(e.message);\n  }\n};\n\nexport const VegaLiteEditor: React.FC<IVegaLiteEditorProps> = ({\n  showModal,\n  setShowModal,\n  value,\n  setValue,\n  alias,\n  setAlias,\n  onSuccess,\n}) => {\n  const [errorMsg, setErrorMsg] = useState('');\n\n  const handleClose = (toSave: boolean) => {\n    if (toSave) {\n      const result = stringToSpec(value);\n      switch (result.tag) {\n        case 'success':\n          setErrorMsg('');\n          onSuccess(alias, result.value);\n          setShowModal(false);\n          return;\n        case 'failure':\n          setErrorMsg(result.value);\n          // NOTE: this does not close the dialog\n          return;\n      }\n    } else {\n      setErrorMsg('');\n      setShowModal(false);\n      return;\n    }\n  };\n\n  const handleChange = (txt: string) => {\n    // NOTE: need to setValue before setErrorMsg\n    setValue(txt);\n    const result = stringToSpec(txt);\n    switch (result.tag) {\n      case 'success':\n        setErrorMsg('');\n        break;\n      case 'failure':\n        setErrorMsg(result.value);\n        break;\n    }\n  };\n\n  const extras = examples.map((example, i) => (\n    <Button key={i} onClick={() => setValue(stringify(example))}>\n      Example {i + 1}\n    </Button>\n  ));\n\n  return (\n    <PopupEditor\n      isOpen={showModal}\n      onClose={handleClose}\n      value={value}\n      onChange={handleChange}\n      alias={alias}\n      setAlias={setAlias}\n      errorMsg={errorMsg}\n      extras={extras}\n    />\n  );\n};\n","import React from 'react';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\n\nexport interface ITooltipTableProps {\n  table: string[][];\n  children: any;\n}\n\nconst useStyles = makeStyles(_ => ({\n  keyColumn: { textAlign: 'right' },\n}));\n\nexport const TooltipTable: React.FC<ITooltipTableProps> = ({\n  table,\n  children,\n}) => {\n  const classes = useStyles();\n  const title = (\n    <table>\n      <tbody>\n        {table.map(([key, val]) => (\n          <tr key={key}>\n            <td className={classes.keyColumn}>\n              <strong>{key}</strong>:\n            </td>\n            <td>{val}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n\n  return (\n    <Tooltip placement=\"top\" title={title}>\n      {children}\n    </Tooltip>\n  );\n};\n","import React from 'react';\nimport { shallowEqual } from 'react-redux';\nimport Vega from 'react-vega';\nimport NativeVegaLite from 'react-vega-lite';\n\nexport const VegaLite = React.memo(\n  NativeVegaLite,\n  ({ spec: xSpec, ...xRest }, { spec: ySpec, ...yRest }) => {\n    return shallowEqual(xRest, yRest) && Vega.isSameSpec(xSpec, ySpec);\n  }\n);\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport stringify from 'json-stringify-pretty-compact';\nimport Delete from '@material-ui/icons/Delete';\nimport Edit from '@material-ui/icons/Edit';\nimport { VegaLiteEditor } from './VegaLiteEditor';\nimport { TooltipTable } from './TooltipTable';\nimport Fab from '@material-ui/core/Fab';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport {\n  sidebarWidth,\n  borderWidth,\n  activeBorderColor,\n  borderColor,\n  hoverBorderColor,\n  mouseDownBorderColor,\n} from '../variables';\nimport { VegaLite } from './VegaLite';\n\nexport interface ISpecPreviewProps {\n  spec: IBaseSpec;\n}\n\nconst useStyles = makeStyles(theme => ({\n  wrapper: {\n    height: sidebarWidth,\n    '&::after': {\n      display: 'block',\n      position: 'absolute',\n      width: sidebarWidth - 2 * borderWidth,\n      backgroundImage:\n        'linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(0, 0, 0, 0.5))',\n      height: '75%',\n      content: \"''\",\n      bottom: 0,\n      alignSelf: 'center',\n    },\n  },\n  image: {\n    overflow: 'hidden',\n    height: sidebarWidth,\n    width: sidebarWidth - 2 * borderWidth,\n  },\n  preview: {\n    position: 'relative',\n    userSelect: 'none',\n    width: sidebarWidth,\n    marginTop: 5,\n    marginLeft: 'auto',\n    marginRight: 'auto',\n    border: borderWidth,\n    borderColor: ((active: boolean) =>\n      active ? activeBorderColor : borderColor) as any,\n    borderStyle: 'solid',\n    '&:hover': {\n      borderColor: ((active: boolean) =>\n        active ? activeBorderColor : hoverBorderColor) as any,\n    },\n    '&:active': {\n      borderColor: mouseDownBorderColor,\n    },\n    cursor: 'pointer',\n  },\n  center: {\n    position: 'absolute',\n    left: '50%',\n    transform: 'translate(-50%, 0)',\n  },\n  top: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n    '& button': {\n      marginRight: theme.spacing(1),\n      marginTop: theme.spacing(1),\n    },\n  },\n  bottom: {\n    bottom: 10,\n    color: 'white',\n  },\n}));\n\nexport const SpecPreview: React.FC<ISpecPreviewProps> = ({ spec }) => {\n  const [showModal, setShowModal] = useState(false);\n  const [currentSpec, setCurrentSpec] = useState('');\n  const [currentAlias, setCurrentAlias] = useState('');\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  const dispatch = useDispatch();\n\n  const active = useSelector((state: IGlobalState) =>\n    state.current.operands.includes(spec.id)\n  );\n\n  const handleModify = () => {\n    setCurrentSpec(stringify(spec.spec));\n    setCurrentAlias(spec.alias);\n    setShowModal(true);\n  };\n\n  const handleDeleteMouseEnter = () => setIsDeleting(true);\n  const handleDeleteMouseLeave = () => setIsDeleting(false);\n\n  const handleDelete = () => {\n    dispatch({ type: 'delete-spec', id: spec.id });\n  };\n\n  const handleSuccess = (alias: string, json: IRawSpec) => {\n    dispatch({ type: 'modify-spec', json, alias, id: spec.id });\n  };\n\n  const handleToggleActive = () => {\n    if (!isDeleting) {\n      dispatch({ type: 'select-operand', operand: spec.id });\n    }\n  };\n\n  const markToString = (mark: string | { type: string }) => {\n    if (typeof mark === 'string') {\n      return mark;\n    } else {\n      return mark.type;\n    }\n  };\n\n  const dataToString = (data: IRawData) => {\n    return 'url' in data ? data['url'] : 'Embeded data';\n  };\n\n  const classes = useStyles(active);\n  const table = spec.spec.mark\n    ? [\n        ['Data URL', dataToString(spec.spec.data)],\n        ['Mark Type', markToString(spec.spec.mark)],\n      ]\n    : [['Composite View', getCompositeViewType(spec.spec)]];\n\n  return (\n    <>\n      <ListItem\n        disableGutters\n        className={classes.preview}\n        onClick={handleToggleActive}\n      >\n        <TooltipTable table={table}>\n          <div className={classes.wrapper}>\n            <div className={classes.image}>\n              <VegaLite\n                spec={spec.spec}\n                // This size restriction makes the elements in visualized spec layed out incorrectly\n                width={sidebarWidth}\n                height={sidebarWidth}\n              />\n            </div>\n          </div>\n        </TooltipTable>\n\n        <div className={classes.top}>\n          <Fab size=\"small\" color=\"primary\" onClick={handleModify}>\n            <Edit />\n          </Fab>\n          <Fab\n            size=\"small\"\n            color=\"secondary\"\n            onClick={handleDelete}\n            onMouseEnter={handleDeleteMouseEnter}\n            onMouseLeave={handleDeleteMouseLeave}\n          >\n            <Delete />\n          </Fab>\n        </div>\n\n        <div className={classes.center + ' ' + classes.bottom}>\n          {spec.alias}\n        </div>\n      </ListItem>\n      <VegaLiteEditor\n        showModal={showModal}\n        setShowModal={setShowModal}\n        onSuccess={handleSuccess}\n        value={currentSpec}\n        setValue={setCurrentSpec}\n        alias={currentAlias}\n        setAlias={setCurrentAlias}\n      />\n    </>\n  );\n};\n\nfunction getCompositeViewType(spec): string {\n  if (spec.layer) return 'Layer View';\n  else if (spec.concat || spec.hconcat || spec.vconcat) return 'Concat View';\n  else if (spec.spec) {\n    if (spec.facet) return 'Facet View';\n    else return 'Repeat View';\n  } else return 'Undefined';\n}\n","export const sidebarWidth = 150;\nexport const borderWidth = 3;\nexport const defaultVegaLiteHeight = 200;\nexport const defaultVegaLiteWidth = 200;\nexport const defaultVegaLiteShortHeight = 20;\nexport const defaultVegaLiteShortWidth = 20;\n\nexport const borderColor = 'lightgrey';\nexport const hoverBorderColor = 'darkgrey';\nexport const activeBorderColor = '#ed553b';\nexport const mouseDownBorderColor = 'grey';\n","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport List from '@material-ui/core/List';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { SpecPreview } from './SpecPreview';\n\nconst useStyles = makeStyles(_ => ({\n  list: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    flexGrow: 1,\n    paddingTop: 0,\n    paddingBottom: 0,\n    display: 'flex',\n    flexDirection: 'column',\n    alignContent: 'center',\n  },\n}));\n\nexport const NavigationBar: React.FC = () => {\n  const classes = useStyles();\n  const specs = useSelector((state: IGlobalState) => state.current.specs);\n\n  return (\n    <List className={classes.list}>\n      {specs.map(spec => (\n        <SpecPreview key={spec.id} spec={spec} />\n      ))}\n    </List>\n  );\n};\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport PlaylistAdd from '@material-ui/icons/PlaylistAdd';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { VegaLiteEditor } from './VegaLiteEditor';\n\nconst useStyles = makeStyles(theme => ({\n  button: { marginBottom: theme.spacing(1) },\n}));\n\nexport const NewSpec: React.FC = () => {\n  const [showModal, setShowModal] = useState(false);\n  const [currentSpec, setCurrentSpec] = useState('');\n  const [currentAlias, setCurrentAlias] = useState('');\n\n  const dispatch = useDispatch();\n\n  const handleSuccess = (alias: string, json: IRawSpec) => {\n    dispatch({ type: 'add-spec', json, alias });\n  };\n\n  const handleOpen = () => {\n    setCurrentSpec('');\n    setCurrentAlias('Untitled');\n    setShowModal(true);\n  };\n\n  const classes = useStyles();\n\n  return (\n    <>\n      <Button onClick={handleOpen} className={classes.button}>\n        <PlaylistAdd /> &nbsp; New Spec\n      </Button>\n      <VegaLiteEditor\n        showModal={showModal}\n        setShowModal={setShowModal}\n        onSuccess={handleSuccess}\n        value={currentSpec}\n        setValue={setCurrentSpec}\n        alias={currentAlias}\n        setAlias={setCurrentAlias}\n      />\n    </>\n  );\n};\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\n\nimport {\n  borderWidth,\n  activeBorderColor,\n  borderColor,\n  hoverBorderColor,\n  mouseDownBorderColor,\n} from '../../variables';\n\ninterface ActiveStatus {\n  isActive: boolean;\n  toHover: boolean;\n}\n\nexport const useStyles = makeStyles(_ => ({\n  main: {\n    padding: 10,\n    border: borderWidth,\n    borderColor: ((status: ActiveStatus) =>\n      status.isActive ? activeBorderColor : borderColor) as any,\n    borderStyle: 'solid',\n    '&:hover': {\n      borderColor: ((status: ActiveStatus) =>\n        status.isActive\n          ? activeBorderColor\n          : status.toHover\n          ? borderColor\n          : hoverBorderColor) as any,\n    },\n    '&:active': {\n      borderColor: mouseDownBorderColor,\n    },\n    cursor: 'pointer',\n    backgroundColor: 'white',\n    display: 'flex',\n    justifyContent: 'flex-start',\n    alignItems: 'flex-start',\n  },\n}));\n\nexport interface IViewComponentProps {\n  view: View;\n  setIsHovering?: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nexport const makeViewComponent = (\n  View: React.FC<IViewComponentProps>\n): React.FC<IViewComponentProps> => ({ view, setIsHovering }) => {\n  const thisId = view.id;\n  const dispatch = useDispatch();\n  const [isHoveringChild, setIsHoveringChild] = useState(false);\n  const isOperandIncluded = useSelector((state: IGlobalState) =>\n    state.current.operands.includes(thisId)\n  );\n  const handleToggleActive = () => {\n    if (!isHoveringChild) {\n      dispatch({\n        type: 'select-operand',\n        operand: thisId,\n      });\n    }\n  };\n  const classes = useStyles({\n    isActive: isOperandIncluded,\n    toHover: isHoveringChild,\n  });\n  return (\n    <div\n      className={classes.main}\n      onClick={handleToggleActive}\n      onMouseEnter={() => setIsHovering && setIsHovering(true)}\n      onMouseLeave={() => setIsHovering && setIsHovering(false)}\n    >\n      <View view={view} setIsHovering={setIsHoveringChild} />\n    </div>\n  );\n};\n","import React from 'react';\nimport { IViewComponentProps, makeViewComponent } from './ViewComponent';\nimport { VegaLite } from '../VegaLite';\n\nexport const UnitComponent: React.FC<IViewComponentProps> = makeViewComponent(\n  ({ view }) => <VegaLite spec={view.export()} />\n);\n","import React from 'react';\nimport { IViewComponentProps, makeViewComponent } from './ViewComponent';\nimport { VegaLite } from '../VegaLite';\n\nexport const LayerComponent: React.FC<IViewComponentProps> = makeViewComponent(\n  ({ view }) => <VegaLite spec={view.export()} />\n);\n","import React from 'react';\nimport { IViewComponentProps, makeViewComponent } from './ViewComponent';\nimport { render } from './Renderer';\nimport { ConcatView } from '../../SyntaxTree/ConcatView';\n\nexport const ConcatComponent: React.FC<IViewComponentProps> = makeViewComponent(\n  ({ view, setIsHovering }) => {\n    const concatView = view as ConcatView;\n    const subViews = concatView.getSubViews();\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: concatView.getOrient() === 'h' ? 'row' : 'column',\n        }}\n      >\n        {subViews.map(subView => render(subView, setIsHovering))}\n      </div>\n    );\n  }\n);\n","import React from 'react';\nimport { IViewComponentProps, makeViewComponent } from './ViewComponent';\nimport { VegaLite } from '../VegaLite';\n\nexport const FacetComponent: React.FC<IViewComponentProps> = makeViewComponent(\n  ({ view }) => <VegaLite spec={view.export()} />\n);\n","import React from 'react';\nimport { IViewComponentProps, makeViewComponent } from './ViewComponent';\nimport { VegaLite } from '../VegaLite';\n\nexport const RepeatComponent: React.FC<IViewComponentProps> = makeViewComponent(\n  ({ view }) => <VegaLite spec={view.export()} />\n);\n","import React from 'react';\nimport { UnitComponent } from './UnitComponent';\nimport { LayerComponent } from './LayerComponent';\nimport { ConcatComponent } from './ConcatComponent';\nimport { FacetComponent } from './FacetComponent';\nimport { RepeatComponent } from './RepeatConponent';\n\nexport const render = (\n  view: View,\n  setIsHovering?: React.Dispatch<React.SetStateAction<boolean>>\n) => {\n  const getRenderer = () => {\n    switch (view.type) {\n      case 'unit':\n        return UnitComponent;\n      case 'layer':\n        return LayerComponent;\n      case 'concat':\n        return ConcatComponent;\n      case 'facet':\n        return FacetComponent;\n      case 'repeat':\n        return RepeatComponent;\n      default:\n        throw new Error(`${view.type} view has not been implemented`);\n    }\n  };\n  const Renderer = getRenderer();\n  return <Renderer view={view} setIsHovering={setIsHovering} />;\n};\n","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { render } from './views/Renderer';\n\nconst useStyles = makeStyles(theme => ({\n  main: {\n    backgroundColor: theme.palette.grey[200],\n    marginTop: theme.spacing(1),\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  emptyView: {\n    color: 'darkgrey',\n    fontSize: 20,\n  },\n}));\n\nexport const MainView: React.FC = () => {\n  const classes = useStyles();\n  const tree = useSelector((state: IGlobalState) => state.current.tree);\n  return (\n    <div className={classes.main}>\n      {tree ? (\n        render(tree)\n      ) : (\n        <div className={classes.emptyView}>Empty View</div>\n      )}\n    </div>\n  );\n};\n","import { View } from './View';\nimport {\n  isUnitSpec,\n  isLayerSpec,\n  isRepeatSpec,\n  isFacetSpec,\n} from 'vega-lite/build/src/spec';\nimport {\n  isConcatSpec,\n  isHConcatSpec,\n  isVConcatSpec,\n} from 'vega-lite/build/src/spec/concat';\nimport * as R from 'ramda';\n\n/**\n * Move an element that index `from` to the index `to` and shift the rest to the\n * index `from`.\n * For example: in an array with 4 elements [0, 1, 2, 3], calling\n * rearrange(2, 0) result in the rearrangement of the elements to [2, 0, 1, 3]\n * @param {Array} arr array containing the elements to be moved.\n * @param {number} from the index of the element to be moved from.\n * @param {number} to the index of the element to be moved to.\n */\nexport function moveElement(arr: Array<any>, from: number, to: number) {\n  if (!(from in arr && to in arr)) {\n    throw new Error(\n      `from (=${from}) or to (=${to}) is out of arr bound (=[0,${arr.length -\n        1}])`\n    );\n  }\n\n  const fromElm = arr[from];\n  if (from < to) {\n    for (let i = from; i < to; i++) {\n      arr[i] = arr[i + 1];\n    }\n  } else {\n    for (let i = from; i > to; i--) {\n      arr[i] = arr[i - 1];\n    }\n  }\n  arr[to] = fromElm;\n}\n\nexport function getData(spec: IRawSpec): IRawData[] {\n  if (isUnitSpec(spec)) {\n    return spec.data ? [spec.data] : [];\n  }\n  if (isRepeatSpec(spec) || isFacetSpec(spec)) {\n    return [...getData(spec.spec), ...(spec.data ? [spec.data] : [])];\n  }\n\n  let specs: any[] = [];\n\n  if (isLayerSpec(spec)) {\n    specs = spec.layer;\n  } else if (isConcatSpec(spec)) {\n    specs = spec.concat;\n  } else if (isHConcatSpec(spec)) {\n    specs = spec.hconcat;\n  } else if (isVConcatSpec(spec)) {\n    specs = spec.vconcat;\n  }\n\n  return [\n    ...specs\n      .map(innerSpec => {\n        return getData(innerSpec);\n      })\n      .flat(),\n    ...(spec.data ? [spec.data] : []),\n  ];\n}\n\nexport function containsDifferentData(spec: IRawSpec): boolean {\n  const datasets = getData(spec);\n  if (datasets.length === 0) return true;\n  const check = datasets[0];\n  for (const dataset of datasets) {\n    if (!R.equals(dataset, check)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function extractData(spec: IRawSpec): { spec: {}; data: IRawData[] } {\n  return _extractData(jsonCopy(spec));\n}\n\nfunction _extractData(spec: IRawSpec): { spec: {}; data: IRawData[] } {\n  if (isUnitSpec(spec)) {\n    const { data, ...newSpec } = spec;\n    return { data: data ? [data] : [], spec: newSpec };\n  }\n  if (isRepeatSpec(spec) || isFacetSpec(spec)) {\n    const { data } = spec;\n    const { data: extractedData, spec: extractedSpec } = _extractData(\n      spec.spec\n    );\n    spec.spec = extractedSpec;\n    return { data: [...(data ? [data] : []), ...extractedData], spec };\n  }\n\n  let key: string = '';\n  if (isLayerSpec(spec)) {\n    key = 'layer';\n  } else if (isConcatSpec(spec)) {\n    key = 'concat';\n  } else if (isHConcatSpec(spec)) {\n    key = 'hconcat';\n  } else if (isVConcatSpec(spec)) {\n    key = 'vconcat';\n  }\n\n  const { data } = spec;\n  const outputData: IRawData[] = data ? [data] : [];\n  for (let i = 0; i < spec[key].length; i++) {\n    const { data: extractedData, spec: extractedSpec } = _extractData(\n      spec[key][i]\n    );\n    outputData.push(...extractedData);\n    spec[key][i] = extractedSpec;\n  }\n  return { data: outputData, spec };\n}\n\nexport function findViewInArray(id: number, views: View[], currentView: View) {\n  if (id === currentView.id) return { parent: null, view: currentView };\n  for (const view of views) {\n    const result = view.findView(id);\n    if (result !== null) {\n      return result.parent !== null\n        ? result\n        : { ...result, parent: currentView };\n    }\n  }\n  return null;\n}\n\nexport function replaceViewInArray(\n  view: View,\n  views: View[],\n  id: number\n): boolean {\n  for (let i = 0; i < views.length; i++) {\n    if (views[i].id === id) {\n      views[i] = view;\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function jsonCopy(obj: {}) {\n  return JSON.parse(JSON.stringify(obj));\n}\n","import { jsonCopy } from './Utils';\n\nlet idCounter = 1;\n\nexport abstract class View {\n  protected _id: number;\n  private _type: ViewType;\n\n  constructor(type: ViewType) {\n    // NOTE: if possible, get rid of this mutation, but if not, that's fine\n    this._id = idCounter++;\n    this._type = type;\n  }\n\n  public get type(): ViewType {\n    return this._type;\n  }\n\n  public get id(): number {\n    return this._id;\n  }\n\n  /**\n   * export Vega-Lite spec in vl.json format\n   * @returns exported Vega-Lite spec\n   */\n  abstract export(): object;\n\n  abstract clone(): View;\n\n  abstract deepClone(): View;\n\n  abstract findView(id: number): { parent: View | null; view: View } | null;\n\n  abstract replaceChild(view: View, id: number): boolean;\n}\n\n/**\n * An indicator for a view in CompositView.\n * Concat and Layer need a View and UnitView to indicate the appearance of the view,\n * while Repeat only need a string that specify a field to indicate\n * the appearance of the view.\n * Facet only need a field name for each axis to specify facet property, so\n * it should not have a parameter. Thus, we use null.\n * TODO: explain this better!\n */\ntype ViewIndicator = View | string | null;\n\nexport abstract class CompositeView<V extends ViewIndicator> extends View {\n  /**\n   * Move subview at the position `from` to position `to`.\n   * For example: in composite view with 4 subviews [0, 1, 2, 3], calling\n   * rearrange(2, 0) result in the rearrangement of the subview to [2, 0, 1, 3]\n   * @param {number} form the index of the view to be moved from.\n   * @param {number} to the index of the view to be moved to.\n   * @param {any} option an extra option for rearrangement.\n   */\n  abstract rearrange(from: number, to: number, option: any): void;\n\n  /**\n   * Append another view with a ViewIdicator `viewIndicator`\n   * @param {V} viewIndicator the ViewIndicator to be appended.\n   * @param {any} option an extra option for appending.\n   */\n  abstract append(viewIndicator: V, option: any): void;\n\n  /**\n   * Prepend another view with a ViewIdicator `viewIndicator`\n   * @param {V} viewIndicator the ViewIndicator to be prepended.\n   * @param {any} option an extra option for appending.\n   */\n  abstract prepend(viewIndicator: V, option: any): void;\n\n  /**\n   * Remove a view from composite view\n   * @param {number} the index of the view to be removed\n   * @param {any} option an extra option for removing\n   */\n  abstract remove(index: number, option: any): void;\n\n  /**\n   * Check if `viewIndicator` is competible with the current view\n   * @param {V} viewIndicator a view indicator to be checked\n   * @returns true if `viewIndicator` is competible with the current view\n   *          false otherwise.\n   */\n  abstract isCompatible(viewIndicator: V): boolean;\n\n  abstract getSubViews(): View[];\n}\n\nexport class UnitView extends View {\n  private spec: IRawSpec;\n\n  /**\n   * Construct a unit view with a valid Vega-Lite spec.\n   * @param {object} spec Vega-Lite spec\n   */\n  public constructor(spec: IRawSpec) {\n    super('unit');\n    this.spec = spec;\n  }\n\n  public edit(spec: IRawSpec) {\n    this.spec = spec;\n  }\n\n  public export() {\n    return jsonCopy(this.spec);\n  }\n\n  public clone() {\n    const cloned = new UnitView(this.spec);\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public deepClone() {\n    const cloned = new UnitView(jsonCopy(this.spec));\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public findView(id: number) {\n    return this._id === id ? { parent: null, view: this } : null;\n  }\n\n  public replaceChild(_view: View, _id: number): boolean {\n    throw new Error('UnitView cannot replace child');\n  }\n\n  public getEncoding() {\n    return this.spec['encoding'];\n  }\n}\n","import { CompositeView, UnitView } from './View';\nimport { moveElement, findViewInArray, replaceViewInArray } from './Utils';\n\nexport class LayerView extends CompositeView<UnitView> {\n  private layer: UnitView[];\n\n  public constructor() {\n    super('layer');\n    this.layer = [];\n  }\n\n  public export() {\n    return { layer: this.layer.map(l => l.export()) };\n  }\n\n  public append(view: UnitView) {\n    this.layer.push(view);\n  }\n\n  public prepend(view: UnitView) {\n    this.layer.unshift(view);\n  }\n\n  public remove(index: number) {\n    this.layer.splice(index, 1);\n  }\n\n  public isCompatible(view: UnitView): boolean {\n    const spec = view.export();\n    return (\n      !spec['spec'] && !spec['concat'] && !spec['hconcat'] && !spec['vconcat']\n    );\n  }\n\n  public rearrange(from: number, to: number) {\n    moveElement(this.layer, from, to);\n  }\n\n  public clone() {\n    const cloned = new LayerView();\n    cloned._id = this._id;\n    cloned.layer = [...this.layer];\n    return cloned;\n  }\n\n  public deepClone() {\n    const cloned = new LayerView();\n    cloned._id = this._id;\n    cloned.layer = this.layer.map(view => view.deepClone());\n    return cloned;\n  }\n\n  public findView(id: number) {\n    return findViewInArray(id, this.layer, this);\n  }\n\n  public replaceChild(view: View, id: number) {\n    return replaceViewInArray(view, this.layer, id);\n  }\n\n  public getEncoding() {\n    return this.layer.map(l => l.getEncoding());\n  }\n\n  public getSubViews(): View[] {\n    return [...this.layer];\n  }\n}\n","import { Dispatch } from 'react';\nimport { AnyAction } from 'redux';\n\nexport const operateFactory = (\n  dispatch: Dispatch<AnyAction>,\n  operands: number[]\n) => {\n  return (operator: Operator, extra?: ExtraOperator) => {\n    // make sure that disabled functions properly, and we won't need to\n    // write a check here\n    dispatch({\n      type: 'operate',\n      operands,\n      operator,\n      ...(extra ? { extra } : {}),\n    });\n  };\n};\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport ErrorOutlineOutlined from '@material-ui/icons/ErrorOutlineOutlined';\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown';\nimport { isUnitSpec, isLayerSpec } from 'vega-lite/build/src/spec';\nimport { LayerView } from '../../SyntaxTree/LayerView';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { UnitView } from '../../SyntaxTree/View';\nimport { operateFactory } from './Utils';\nimport { IOperationProps } from '../OperationBar';\nimport { Menu, MenuItem } from '@material-ui/core';\nimport { TooltipTable } from '../TooltipTable';\n\nconst useStyles = makeStyles(() => ({\n  buttonNormal: {},\n  buttonWarn: {\n    '&:hover': {\n      backgroundColor: '#ffd800',\n    },\n  },\n  error: {\n    width: 22,\n    height: 22,\n    color: '#ed1c1c',\n  },\n}));\n\nexport const LayerButton: React.FC<IOperationProps> = ({\n  navBarOperands,\n  mainViewOperands,\n}) => {\n  const classes = useStyles();\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const tree = useSelector((state: IGlobalState) => state.current.tree);\n  const specs = useSelector((state: IGlobalState) => state.current.specs);\n  const operate = operateFactory(useDispatch(), operands);\n  const [anchorEl, setAnchorEl] = useState(null);\n\n  const layerDisabled = layerDisabledCheck(\n    mainViewOperands,\n    navBarOperands,\n    specs,\n    tree\n  );\n  const layerWarn = layerWarnCheck(\n    layerDisabled,\n    specs,\n    navBarOperands,\n    mainViewOperands,\n    tree\n  );\n\n  const handleClickLayer = event => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleSelectOption = (option: InsertOrder) => () => {\n    handleMenuClose();\n    operate('layer', option);\n  };\n\n  const handleMenuClose = () => {\n    setAnchorEl(null);\n  };\n\n  return (\n    <>\n      {layerWarn ? (\n        <TooltipTable\n          table={[['Warning', 'Operands have different encoding(s)']]}\n        >\n          <Button\n            onClick={handleClickLayer}\n            className={classes.buttonWarn}\n            aria-owns={anchorEl ? 'layer-menu' : undefined}\n            aria-haspopup=\"true\"\n          >\n            <ErrorOutlineOutlined className={classes.error} /> &nbsp; Layer\n            <ArrowDropDown />\n          </Button>\n        </TooltipTable>\n      ) : (\n        <Button\n          onClick={handleClickLayer}\n          disabled={layerDisabled}\n          className={classes.buttonNormal}\n          aria-owns={anchorEl ? 'layer-menu' : undefined}\n          aria-haspopup=\"true\"\n        >\n          Layer\n          <ArrowDropDown />\n        </Button>\n      )}\n      <Menu\n        id=\"layer-menu\"\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onClose={handleMenuClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'center',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'center',\n        }}\n      >\n        <MenuItem onClick={handleSelectOption('prepend')}>Under</MenuItem>\n        <MenuItem onClick={handleSelectOption('append')}>Over</MenuItem>\n      </Menu>\n    </>\n  );\n};\n\nfunction layerDisabledCheck(\n  mainViewOperands: number[],\n  navBarOperands: number[],\n  specs: IBaseSpec[],\n  tree: View | null\n): boolean {\n  if (\n    mainViewOperands.length !== 1 ||\n    navBarOperands.length !== 1 ||\n    specs.filter(\n      spec =>\n        navBarOperands.includes(spec.id) &&\n        !isUnitSpec(spec.spec) &&\n        !isLayerSpec(spec.spec)\n    ).length !== 0\n  ) {\n    return true;\n  }\n\n  const mainViewOperand = tree!.findView(mainViewOperands[0]);\n  return (\n    mainViewOperand === null ||\n    (!(mainViewOperand.view instanceof LayerView) &&\n      !isUnitSpec(mainViewOperand.view.export()) &&\n      !isLayerSpec(mainViewOperand.view.export()))\n  );\n}\n\nfunction layerWarnCheck(\n  layerDisabled: boolean,\n  specs: IBaseSpec[],\n  navBarOperands: number[],\n  mainViewOperands: number[],\n  tree: View | null\n): boolean {\n  if (layerDisabled) {\n    return false;\n  }\n\n  const encodings: any[] = [];\n  for (const spec of specs) {\n    if (navBarOperands.includes(spec.id)) {\n      encodings.push(new UnitView(spec.spec).getEncoding());\n    }\n  }\n\n  const mainViewOperand = tree!.findView(mainViewOperands[0])!.view;\n  let mainViewEncodings: any[] = [];\n  if (mainViewOperand instanceof UnitView) {\n    mainViewEncodings = [mainViewOperand.getEncoding()];\n  } else if (mainViewOperand instanceof LayerView) {\n    mainViewEncodings = mainViewOperand.getEncoding();\n  }\n\n  const currentEncodingField = {};\n  const currentEncodingType = {};\n  for (const encoding of encodings.concat(mainViewEncodings)) {\n    for (const key of Object.keys(encoding)) {\n      if (\n        key in currentEncodingField &&\n        (currentEncodingField[key] !== encoding[key].field ||\n          (encoding[key].type &&\n            currentEncodingType[key] !== encoding[key].type))\n      ) {\n        return true;\n      }\n      currentEncodingField[key] = encoding[key].field;\n      currentEncodingType[key] = encoding[key].type;\n    }\n  }\n  return false;\n}\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport { operateFactory } from './Utils';\nimport { IOperationProps } from '../OperationBar';\nimport { Menu, MenuItem } from '@material-ui/core';\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown';\n\nexport const ConcatButton: React.FC<IOperationProps> = ({\n  navBarOperands,\n  mainViewOperands,\n}) => {\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const operate = operateFactory(useDispatch(), operands);\n  const [anchorEl, setAnchorEl] = useState(null);\n\n  const handleClickConcat = event => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleSelectOption = (\n    option: InsertOrder,\n    orient: ConcatOrient\n  ) => () => {\n    handleMenuClose();\n    operate('concat', { option, orient });\n  };\n\n  const handleMenuClose = () => {\n    setAnchorEl(null);\n  };\n\n  const concatDisabled =\n    mainViewOperands.length !== 1 || navBarOperands.length !== 1;\n\n  return (\n    <>\n      <Button\n        onClick={handleClickConcat}\n        disabled={concatDisabled}\n        aria-owns={anchorEl ? 'layer-menu' : undefined}\n        aria-haspopup=\"true\"\n      >\n        Concat\n        <ArrowDropDown />\n      </Button>\n\n      <Menu\n        id=\"layer-menu\"\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onClose={handleMenuClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'center',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'center',\n        }}\n      >\n        <MenuItem onClick={handleSelectOption('prepend', 'h')}>\n          On Left\n        </MenuItem>\n        <MenuItem onClick={handleSelectOption('append', 'h')}>\n          On Right\n        </MenuItem>\n        <MenuItem onClick={handleSelectOption('prepend', 'v')}>On Top</MenuItem>\n        <MenuItem onClick={handleSelectOption('append', 'v')}>\n          On Bottom\n        </MenuItem>\n      </Menu>\n    </>\n  );\n};\n","import { CompositeView } from './View';\nimport { moveElement, findViewInArray, jsonCopy } from './Utils';\n\nexport class RepeatView extends CompositeView<string> {\n  private repeatInfo: RepeatInfo;\n  private view: View;\n\n  public constructor(view: View, repeatInfo: RepeatInfo) {\n    super('repeat');\n    this.repeatInfo = repeatInfo;\n    this.view = view;\n  }\n\n  public export() {\n    return {\n      repeat: this.repeatInfo.export(),\n      spec: applyRepeat(this.view.export(), this.repeatInfo),\n    };\n  }\n\n  /**\n   * Add a repeating axis\n   * @param channel encoding channel for the axis to be repeated\n   * @param orient orient of the added axis\n   */\n  public addAxis(channel: string, orient: 'row' | 'column') {\n    this.repeatInfo.addAxis(channel, orient);\n  }\n\n  /**\n   * Remove a repeating axis\n   * @param orient orient of the removed axis\n   */\n  public removeAxis(orient: 'row' | 'column') {\n    this.repeatInfo.removeAxis(orient);\n  }\n\n  public append(field: string, option: 'row' | 'column') {\n    if (this.repeatInfo.isRepeating(option)) {\n      this.repeatInfo[option].push(field);\n    }\n  }\n\n  public prepend(field: string, option: 'row' | 'column') {\n    if (this.repeatInfo.isRepeating(option)) {\n      this.repeatInfo[option].unshift(field);\n    }\n  }\n\n  public remove(index: number, axis: 'row' | 'column') {\n    this.repeatInfo.remove(index, axis);\n  }\n\n  public isCompatible(_: string): boolean {\n    // repeat is always compatible\n    return true;\n  }\n\n  public rearrange(from: number, to: number, option: 'row' | 'column') {\n    if (this.repeatInfo.isRepeating(option)) {\n      moveElement(this.repeatInfo[option], from, to);\n    }\n  }\n\n  public clone() {\n    const cloned = new RepeatView(this.view, this.repeatInfo);\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public deepClone() {\n    const cloned = new RepeatView(\n      this.view.deepClone(),\n      this.repeatInfo.clone()\n    );\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public findView(id: number) {\n    return findViewInArray(id, [this.view], this);\n  }\n\n  public replaceChild(view: View, id: number) {\n    if (this.view.id === id) {\n      this.view = view;\n      return true;\n    }\n    return false;\n  }\n\n  public getSubViews(): View[] {\n    return [this.view];\n  }\n\n  public changeInfo(info: RepeatInfo) {\n    this.repeatInfo = info;\n  }\n\n  public getInfo() {\n    return this.repeatInfo.clone();\n  }\n}\n\ninterface ChannelInfo {\n  rowChannel?: string;\n  columnChannel?: string;\n}\n\n/**\n * This class contains information for repeat\n */\nexport class RepeatInfo {\n  public row: string[];\n  public column: string[];\n  public rowChannel?: string;\n  public columnChannel?: string;\n\n  public constructor(row: string[], column: string[], info: ChannelInfo) {\n    this.row = info.rowChannel ? row : [];\n    this.column = info.columnChannel ? column : [];\n    this.rowChannel = info.rowChannel;\n    this.columnChannel = info.columnChannel;\n  }\n\n  /**\n   * Add an orient to repeat `channel`\n   * @param orient an orient to be added\n   * @param channel the encoding channel the orient is repeating\n   */\n  public repeat(orient: 'row' | 'column', channel: string) {\n    if (!this.isRepeating(orient)) {\n      this[orient] = [];\n      (this as any)[`${orient}Channel`] = channel;\n    }\n  }\n\n  /**\n   * Check if repeating the `axis`\n   * @param orient orient to be checked if repeating\n   */\n  public isRepeating(orient: 'row' | 'column'): boolean {\n    return !!(this as any)[`${orient}Channel`];\n  }\n\n  public export() {\n    return {\n      ...(this.isRepeating('row') ? { row: jsonCopy(this.row) } : {}),\n      ...(this.isRepeating('column') ? { column: jsonCopy(this.column) } : {}),\n    };\n  }\n\n  public remove(index: number, axis: 'row' | 'column') {\n    this[axis].splice(index, 1);\n  }\n\n  /**\n   * Add a repeating axis\n   * @param channel encoding channel for the axis to be repeated\n   * @param orient orient of the added axis\n   */\n  public addAxis(channel: string, orient: 'row' | 'column') {\n    this[orient] = [];\n    (this as any)[`${orient}Channel`] = channel;\n  }\n\n  /**\n   * Remove a repeating axis\n   * @param orient orient of the removed axis\n   */\n  public removeAxis(orient: 'row' | 'column') {\n    this[orient] = [];\n    (this as any)[`${orient}Channel`] = undefined;\n  }\n\n  public getChannelInfo(): ChannelInfo {\n    return {\n      ...(this.rowChannel ? { rowChannel: this.rowChannel } : {}),\n      ...(this.columnChannel ? { columnChannel: this.columnChannel } : {}),\n    };\n  }\n\n  public clone() {\n    return new RepeatInfo(this.row, this.column, {\n      ...(this.rowChannel ? { rowChannel: this.rowChannel } : {}),\n      ...(this.columnChannel ? { columnChannel: this.columnChannel } : {}),\n    });\n  }\n}\n\n/**\n * list of keys for nested spec\n */\nconst nestedTypes = ['layer', 'concat', 'hconcat', 'vconcat', 'spec'];\n\n/**\n * Apply repeat information `repeat` to `spec`\n * @param spec the spec the repeat information `repeat` to be applied\n * @param repeat the repeat information to apply to `spec`\n */\nfunction applyRepeat(spec: any, repeat: RepeatInfo) {\n  let nestedType: string | undefined = undefined;\n  nestedTypes.forEach(type => {\n    if (spec[type]) {\n      nestedType = type;\n    }\n  });\n\n  const {\n    [nestedType || '$invalid-vl-field$']: nestedSpecs,\n    ...output\n  } = jsonCopy(spec);\n  if (nestedType) {\n    output[nestedType] = nestedSpecs.map((nestedSpec: any) =>\n      applyRepeat(nestedSpec, repeat)\n    );\n  }\n\n  if (output.encoding) {\n    applyRepeatToEncoding(output.encoding, repeat);\n  }\n  return output;\n}\n\n/**\n * Apply repeat information `repeat` to `encoding`\n * @param encoding the encoding repeat information `repeat` to be applied\n * @param repeat the repeat information applying\n */\nfunction applyRepeatToEncoding(encoding: any, repeat: RepeatInfo) {\n  if (repeat.rowChannel && encoding[repeat.rowChannel]) {\n    encoding[repeat.rowChannel].field = { repeat: 'row' };\n  }\n  if (repeat.columnChannel && encoding[repeat.columnChannel]) {\n    encoding[repeat.columnChannel].field = { repeat: 'column' };\n  }\n}\n","import React, { useState, SetStateAction } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport { operateFactory } from '../operations/Utils';\nimport {\n  Dialog,\n  DialogTitle,\n  IconButton,\n  DialogActions,\n  DialogContent,\n  Checkbox,\n  TextField,\n  DialogContentText,\n} from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport Remove from '@material-ui/icons/Remove';\nimport Add from '@material-ui/icons/Add';\nimport makeStyles from '@material-ui/styles/makeStyles';\nimport { RepeatInfo } from '../../SyntaxTree/RepeatView';\n\nexport interface IPopupRepeatOptionProps {\n  isOpen: boolean;\n  onClose: () => void;\n  currentRepeat?: RepeatInfo;\n}\n\nconst useStyles = makeStyles(() => ({\n  channel: {\n    width: 80,\n  },\n  fieldText: {\n    minWidth: 100,\n  },\n  fieldTexts: {\n    display: 'flex',\n    flexDirection: 'column',\n    width: 200,\n  },\n  addAndRemove: {\n    top: 10,\n    width: 40,\n    height: 40,\n  },\n  checkBox: {\n    top: 10,\n    width: 30,\n    height: 30,\n  },\n  axisConfig: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignContent: 'flex-start',\n  },\n}));\n\nexport const PopupRepeatOption: React.FC<IPopupRepeatOptionProps> = ({\n  isOpen,\n  onClose,\n  currentRepeat,\n}) => {\n  const classes = useStyles();\n  const [checkRow, setCheckRow] = useState(false);\n  const [checkColumn, setCheckColumn] = useState(false);\n  const [rowFields, setRowFields] = useState<string[]>(['']);\n  const [rowChannel, setRowChannel] = useState('');\n  const [columnFields, setColumnFields] = useState<string[]>(['']);\n  const [columnChannel, setColumnChannel] = useState('');\n\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const dispatch = useDispatch();\n  const operate = operateFactory(dispatch, operands);\n\n  const handleEntering = () => {\n    setCheckRow(false);\n    setCheckColumn(false);\n    setRowFields(['']);\n    setRowChannel('');\n    setColumnFields(['']);\n    setColumnChannel('');\n\n    if (currentRepeat) {\n      if (currentRepeat.isRepeating('row')) {\n        setCheckRow(true);\n        setRowFields(currentRepeat.row);\n        setRowChannel(currentRepeat.rowChannel as string);\n      }\n      if (currentRepeat.isRepeating('column')) {\n        setCheckColumn(true);\n        setColumnFields(currentRepeat.column);\n        setColumnChannel(currentRepeat.columnChannel as string);\n      }\n    }\n  };\n\n  const operateDisabled = () =>\n    (!(checkRow && rowFields.length !== 0 && rowChannel !== '') &&\n      !(checkColumn && columnFields.length !== 0 && columnChannel !== '')) ||\n    ((checkRow && (rowFields.length === 0 || rowChannel === '')) ||\n      (checkColumn && (columnFields.length === 0 || columnChannel === '')));\n\n  const handleTextChangeFactory = (\n    current: string[],\n    setter: React.Dispatch<React.SetStateAction<string[]>>,\n    index: number\n  ) => event => {\n    const newFields = [...current];\n    newFields[index] = event.target.value;\n    setter(newFields);\n  };\n\n  const axisConfigFactory = (\n    check: boolean,\n    checkSetter: React.Dispatch<SetStateAction<boolean>>,\n    channel: string,\n    channelSetter: React.Dispatch<SetStateAction<string>>,\n    fields: string[],\n    fieldsSetter: React.Dispatch<SetStateAction<string[]>>,\n    axis: string\n  ) => (\n    <div className={classes.axisConfig}>\n      <Checkbox\n        checked={check}\n        onChange={() => checkSetter(!check)}\n        className={classes.checkBox}\n      />\n      <TextField\n        label=\"Channel\"\n        value={channel}\n        onChange={event => channelSetter(event.target.value)}\n        className={classes.channel}\n      />\n      &nbsp; &nbsp;\n      <div className={classes.fieldTexts}>\n        {fields.map((field, index) => (\n          <TextField\n            label={`${axis} Field`}\n            value={field}\n            onChange={handleTextChangeFactory(fields, fieldsSetter, index)}\n            className={classes.fieldText}\n          />\n        ))}\n      </div>\n      &nbsp; &nbsp;\n      <IconButton\n        onClick={() => fieldsSetter([...fields, ''])}\n        className={classes.addAndRemove}\n      >\n        <Add />\n      </IconButton>\n      <IconButton\n        onClick={() => {\n          if (fields.length > 1) {\n            const newFields = [...fields];\n            newFields.splice(-1);\n            fieldsSetter(newFields);\n          }\n        }}\n        className={classes.addAndRemove}\n      >\n        <Remove />\n      </IconButton>\n    </div>\n  );\n\n  const handleRepeat = () => {\n    const info = new RepeatInfo(rowFields, columnFields, {\n      rowChannel,\n      columnChannel,\n    });\n    if (currentRepeat) {\n      dispatch({ type: 'modify-info', operand: operands[0], info });\n    } else {\n      operate('repeat', info);\n    }\n    onClose();\n  };\n\n  const handleDecompose = () => {\n    dispatch({\n      type: 'decompose',\n      operand: operands[0],\n    });\n    onClose();\n  };\n\n  return (\n    <Dialog\n      open={isOpen}\n      onEntering={handleEntering}\n      aria-labelledby=\"repeat-dialog-title\"\n    >\n      <DialogTitle id=\"repeat-dialog-title\">\n        <>Repeat</>\n        <IconButton\n          onClick={onClose}\n          style={{ right: 10, top: 7, position: 'absolute' }}\n        >\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Choose Field(s) and Encoding Channel(s) to repeat.\n        </DialogContentText>\n        {axisConfigFactory(\n          checkRow,\n          setCheckRow,\n          rowChannel,\n          setRowChannel,\n          rowFields,\n          setRowFields,\n          'Row'\n        )}\n        {axisConfigFactory(\n          checkColumn,\n          setCheckColumn,\n          columnChannel,\n          setColumnChannel,\n          columnFields,\n          setColumnFields,\n          'Column'\n        )}\n      </DialogContent>\n      <DialogActions>\n        {currentRepeat ? (\n          <Button onClick={handleDecompose} color=\"secondary\">\n            Decompose\n          </Button>\n        ) : (\n          <></>\n        )}\n        <Button onClick={handleRepeat} autoFocus disabled={operateDisabled()}>\n          Repeat\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","import React, { useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport { IOperationProps, useWarningStyles } from '../OperationBar';\nimport { PopupRepeatOption } from '../popups/PopupRepeatOption';\nimport { containsDifferentData } from '../../SyntaxTree/Utils';\nimport ErrorOutlineOutlined from '@material-ui/icons/ErrorOutlineOutlined';\nimport { TooltipTable } from '../TooltipTable';\n\nexport const RepeatButton: React.FC<IOperationProps> = ({\n  navBarOperands,\n  mainViewOperands,\n  tree,\n}) => {\n  const classes = useWarningStyles();\n  const [isOpen, setIsOpen] = useState(false);\n  const repeatDisabled =\n    mainViewOperands.length !== 1 || navBarOperands.length > 0;\n\n  const repeatWarn =\n    !repeatDisabled &&\n    containsDifferentData(tree!\n      .findView(mainViewOperands[0])!\n      .view.export() as IRawSpec);\n\n  return (\n    <>\n      {repeatWarn ? (\n        <TooltipTable\n          table={[['Warning', 'Not all views are using the same data source']]}\n        >\n          <Button\n            onClick={() => setIsOpen(true)}\n            className={classes.buttonWarn}\n          >\n            <ErrorOutlineOutlined className={classes.error} /> &nbsp; Repeat\n          </Button>\n        </TooltipTable>\n      ) : (\n        <Button\n          onClick={() => setIsOpen(true)}\n          disabled={repeatDisabled}\n          className={classes.buttonNormal}\n        >\n          Repeat\n        </Button>\n      )}\n      <PopupRepeatOption isOpen={isOpen} onClose={() => setIsOpen(false)} />\n    </>\n  );\n};\n","import { View, CompositeView } from './View';\nimport { jsonCopy, findViewInArray, extractData } from './Utils';\n\nexport class FacetView extends CompositeView<null> {\n  private view: View;\n  private facetInfo: FacetInfo;\n\n  public constructor(view: View, facetInfo: FacetInfo) {\n    super('facet');\n    this.facetInfo = facetInfo;\n    this.view = view;\n  }\n\n  public export() {\n    // need a better way to extract data from composed specs\n    const { data, ...spec } = extractData(this.view.export() as IRawSpec);\n    return {\n      data: data[0],\n      facet: this.facetInfo.export(),\n      ...spec,\n    };\n  }\n\n  public append(_: null, option: {}) {\n    // add facet to an available axis\n    if (!this.facetInfo['column']) {\n      this.facetInfo.column = option;\n    } else if (!this.facetInfo['row']) {\n      this.facetInfo.row = option;\n    }\n  }\n\n  public prepend() {\n    throw new Error('prepend is not supported for FacetView');\n  }\n\n  public remove(_: number, axis: 'row' | 'column') {\n    this.facetInfo.remove(axis);\n  }\n\n  public isCompatible(_: any): boolean {\n    // facet is always compatible\n    return true;\n  }\n\n  public rearrange() {\n    // switch between row and column\n    if (this.facetInfo['row'] && this.facetInfo['column']) {\n      this.facetInfo.swapAxis();\n    }\n  }\n\n  public clone() {\n    const cloned = new FacetView(this.view, this.facetInfo);\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public deepClone() {\n    const cloned = new FacetView(this.view.deepClone(), this.facetInfo.clone());\n    cloned._id = this._id;\n    return cloned;\n  }\n\n  public findView(id: number) {\n    return findViewInArray(id, [this.view], this);\n  }\n\n  public replaceChild(view: View, id: number) {\n    if (this.view.id === id) {\n      this.view = view;\n      return true;\n    }\n    return false;\n  }\n\n  public getSubViews(): View[] {\n    return [this.view];\n  }\n\n  public changeInfo(info: FacetInfo) {\n    this.facetInfo = info;\n  }\n\n  public getInfo() {\n    return this.facetInfo.clone();\n  }\n}\n\n/**\n * This class contains information for facet\n */\nexport class FacetInfo {\n  row?: {};\n  column?: {};\n\n  constructor(info: { row?: {}; column?: {} }) {\n    this.row = info.row;\n    this.column = info.column;\n  }\n\n  public export() {\n    return {\n      ...(this.row ? { row: this.row } : {}),\n      ...(this.column ? { column: this.column } : {}),\n    };\n  }\n\n  public swapAxis() {\n    [this.row, this.column] = [this.column, this.row];\n  }\n\n  public remove(axis: 'row' | 'column') {\n    this[axis] = undefined;\n  }\n\n  public clone() {\n    return new FacetInfo({\n      ...(this.row ? { row: jsonCopy(this.row) } : {}),\n      ...(this.column ? { column: jsonCopy(this.column) } : {}),\n    });\n  }\n}\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport { FacetInfo } from '../../SyntaxTree/FacetView';\nimport { operateFactory } from '../operations/Utils';\nimport {\n  Dialog,\n  DialogTitle,\n  IconButton,\n  DialogActions,\n  DialogContent,\n  Checkbox,\n  TextField,\n  Select,\n  MenuItem,\n  FormControl,\n  InputLabel,\n  DialogContentText,\n} from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport makeStyles from '@material-ui/styles/makeStyles';\n\nexport interface IPopupFacetOptionProps {\n  isOpen: boolean;\n  onClose: () => void;\n  currentFacet?: FacetInfo;\n}\n\nconst useStyles = makeStyles(() => ({\n  typeSelector: {\n    minWidth: 60,\n  },\n  checkBox: {\n    top: 10,\n  },\n}));\n\nexport const PopupFacetOption: React.FC<IPopupFacetOptionProps> = ({\n  isOpen,\n  onClose,\n  currentFacet,\n}) => {\n  const classes = useStyles();\n  const [checkRow, setCheckRow] = useState(false);\n  const [checkColumn, setCheckColumn] = useState(false);\n  const [rowField, setRowField] = useState('');\n  const [rowType, setRowType] = useState('');\n  const [columnField, setColumnField] = useState('');\n  const [columnType, setColumnType] = useState('');\n\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const dispatch = useDispatch();\n  const operate = operateFactory(dispatch, operands);\n\n  const handleEntering = () => {\n    setCheckRow(false);\n    setCheckColumn(false);\n    setRowField('');\n    setRowType('');\n    setColumnField('');\n    setColumnType('');\n\n    if (currentFacet) {\n      if (currentFacet['row']) {\n        setCheckRow(true);\n        setRowField(currentFacet['row']['field']);\n        setRowType(currentFacet['row']['type']);\n      }\n      if (currentFacet['column']) {\n        setCheckColumn(true);\n        setColumnField(currentFacet['column']['field']);\n        setColumnType(currentFacet['column']['type']);\n      }\n    }\n  };\n\n  const axisConfigFactory = (\n    check: boolean,\n    checkSetter: React.Dispatch<React.SetStateAction<boolean>>,\n    field: string,\n    fieldSetter: React.Dispatch<React.SetStateAction<string>>,\n    type: string,\n    typeSetter: React.Dispatch<React.SetStateAction<string>>,\n    axis: 'Row' | 'Column'\n  ) => (\n    <div>\n      <Checkbox\n        checked={check}\n        onChange={() => checkSetter(!check)}\n        className={classes.checkBox}\n      />\n      <TextField\n        label={`${axis} Field`}\n        value={field}\n        onChange={event => fieldSetter(event.target.value)}\n      />\n      &nbsp; &nbsp;\n      <FormControl>\n        <InputLabel htmlFor=\"row-type\">Type</InputLabel>\n        <Select\n          value={type}\n          onChange={event => typeSetter(event.target.value as string)}\n          inputProps={{\n            name: 'type',\n            id: 'row-type',\n          }}\n          className={classes.typeSelector}\n        >\n          <MenuItem value={'nominal'}>Nominal</MenuItem>\n          <MenuItem value={'ordinal'}>Ordinal</MenuItem>\n          <MenuItem value={'quantitative'}>Quantitative</MenuItem>\n          <MenuItem value={'temporal'}>Temporal</MenuItem>\n        </Select>\n      </FormControl>\n    </div>\n  );\n\n  const handleFacet = () => {\n    const info = new FacetInfo({\n      ...(checkColumn\n        ? { column: { field: columnField, type: columnType } }\n        : {}),\n      ...(checkRow ? { row: { field: rowField, type: rowType } } : {}),\n    });\n    if (currentFacet) {\n      dispatch({ type: 'modify-info', operand: operands[0], info });\n    } else {\n      operate('facet', info);\n    }\n    onClose();\n  };\n\n  const handleDecompose = () => {\n    dispatch({\n      type: 'decompose',\n      operand: operands[0],\n    });\n    onClose();\n  };\n\n  const operateDisabled = () =>\n    (!(checkRow && rowField !== '' && rowType !== '') &&\n      !(checkColumn && columnField !== '' && columnType !== '')) ||\n    ((checkRow && (rowField === '' || rowType === '')) ||\n      (checkColumn && (columnField === '' || columnType === '')));\n\n  return (\n    <Dialog\n      open={isOpen}\n      onEntering={handleEntering}\n      aria-labelledby=\"facet-dialog-title\"\n    >\n      <DialogTitle id=\"facet-dialog-title\">\n        <>Facet</>\n        <IconButton\n          onClick={onClose}\n          style={{ right: 10, top: 7, position: 'absolute' }}\n        >\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Choose Field(s) and Type(s) to facet.\n        </DialogContentText>\n        {axisConfigFactory(\n          checkRow,\n          setCheckRow,\n          rowField,\n          setRowField,\n          rowType,\n          setRowType,\n          'Row'\n        )}\n        {axisConfigFactory(\n          checkColumn,\n          setCheckColumn,\n          columnField,\n          setColumnField,\n          columnType,\n          setColumnType,\n          'Column'\n        )}\n      </DialogContent>\n      <DialogActions>\n        {currentFacet ? (\n          <Button onClick={handleDecompose} color=\"secondary\">\n            Decompose\n          </Button>\n        ) : (\n          <></>\n        )}\n        <Button onClick={handleFacet} autoFocus disabled={operateDisabled()}>\n          Facet\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","import React, { useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport { PopupFacetOption } from '../popups/PopupFacetOption';\nimport { IOperationProps, useWarningStyles } from '../OperationBar';\nimport { containsDifferentData } from '../../SyntaxTree/Utils';\nimport ErrorOutlineOutlined from '@material-ui/icons/ErrorOutlineOutlined';\nimport { TooltipTable } from '../TooltipTable';\n\nexport const FacetButton: React.FC<IOperationProps> = ({\n  navBarOperands,\n  mainViewOperands,\n  tree,\n}) => {\n  const classes = useWarningStyles();\n  const [isOpen, setIsOpen] = useState(false);\n  const facetDisabled =\n    mainViewOperands.length !== 1 || navBarOperands.length > 0;\n\n  const facetWarn =\n    !facetDisabled &&\n    containsDifferentData(tree!\n      .findView(mainViewOperands[0])!\n      .view.export() as IRawSpec);\n\n  return (\n    <>\n      {facetWarn ? (\n        <TooltipTable\n          table={[['Warning', 'Not all views are using the same data source']]}\n        >\n          <Button\n            onClick={() => setIsOpen(true)}\n            className={classes.buttonWarn}\n          >\n            <ErrorOutlineOutlined className={classes.error} /> &nbsp; Facet\n          </Button>\n        </TooltipTable>\n      ) : (\n        <Button\n          onClick={() => setIsOpen(true)}\n          disabled={facetDisabled}\n          className={classes.buttonNormal}\n        >\n          Facet\n        </Button>\n      )}\n      <PopupFacetOption isOpen={isOpen} onClose={() => setIsOpen(false)} />\n    </>\n  );\n};\n","import React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport { operateFactory } from './Utils';\nimport { IOperationProps } from '../OperationBar';\n\nexport const PlaceButton: React.FC<IOperationProps> = ({\n  navBarOperands,\n  mainViewOperands,\n}) => {\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const tree = useSelector((state: IGlobalState) => state.current.tree);\n\n  const operate = operateFactory(useDispatch(), operands);\n\n  const placeDisabled =\n    (mainViewOperands.length === 0 ? tree !== null : false) ||\n    navBarOperands.length !== 1;\n\n  const toReplace = tree !== null;\n\n  return (\n    <Button\n      onClick={() => operate(toReplace ? 'replace' : 'place')}\n      disabled={placeDisabled}\n    >\n      {toReplace ? 'Replace' : 'Place'}\n    </Button>\n  );\n};\n","import React from 'react';\nimport Button from '@material-ui/core/Button';\nimport Launch from '@material-ui/icons/Launch';\n\nexport interface IExportButtonProps {\n  tree: View | null;\n}\n\nexport const ExportButton: React.FC<IExportButtonProps> = ({ tree }) => {\n  const exportDisabled = tree === null;\n  const doanloadJson = () => {\n    const element = document.createElement('a');\n    const file = new Blob([JSON.stringify(tree!.export(), null, 2)], {\n      type: 'application/json',\n    });\n    element.href = URL.createObjectURL(file);\n    element.download = 'visualization.json';\n    document.body.appendChild(element);\n    element.click();\n  };\n\n  return (\n    <Button onClick={doanloadJson} color=\"primary\" disabled={exportDisabled}>\n      <Launch /> &nbsp; Export\n    </Button>\n  );\n};\n","import React, { SetStateAction } from 'react';\nimport { VegaLite } from '../VegaLite';\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n  borderWidth,\n  activeBorderColor,\n  borderColor,\n  hoverBorderColor,\n  mouseDownBorderColor,\n} from '../../variables';\n\nexport interface IViewPreviewProps {\n  view: View;\n  selectedSubViewId: number | null;\n  setSelectedSubViewId: React.Dispatch<SetStateAction<number | null>>;\n}\nconst useStyles = makeStyles(() => ({\n  preview: {\n    border: borderWidth,\n    borderColor: ((active: boolean) =>\n      active ? activeBorderColor : borderColor) as any,\n    borderStyle: 'solid',\n    '&:hover': {\n      borderColor: ((active: boolean) =>\n        active ? activeBorderColor : hoverBorderColor) as any,\n    },\n    '&:active': {\n      borderColor: mouseDownBorderColor,\n    },\n    cursor: 'pointer',\n  },\n}));\n\nexport const ViewPreview: React.FC<IViewPreviewProps> = ({\n  view,\n  selectedSubViewId,\n  setSelectedSubViewId,\n}) => {\n  const classes = useStyles(selectedSubViewId === view.id);\n\n  const onToggleActive = () => {\n    setSelectedSubViewId(selectedSubViewId !== view.id ? view.id : null);\n  };\n\n  return (\n    <div className={classes.preview} onClick={onToggleActive}>\n      <VegaLite spec={view.export()} />\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport {\n  Dialog,\n  DialogTitle,\n  IconButton,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  Switch,\n} from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport ArrowBack from '@material-ui/icons/ArrowBack';\nimport ArrowForward from '@material-ui/icons/ArrowForward';\nimport ArrowUpward from '@material-ui/icons/ArrowUpward';\nimport ArrowDownward from '@material-ui/icons/ArrowDownward';\nimport { ConcatView } from '../../SyntaxTree/ConcatView';\nimport { ViewPreview } from './ViewPreview';\nimport makeStyles from '@material-ui/styles/makeStyles';\n\nexport interface IPopupConcatOptionProps {\n  isOpen: boolean;\n  onClose: () => void;\n  tree: View | null;\n}\n\nconst useStyles = makeStyles(() => ({\n  views: {\n    display: 'flex',\n    justifyContent: 'center',\n    flexDirection: (direction => (direction ? 'row' : 'column')) as any,\n    alignItems: 'center',\n  },\n  actions: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    flexDirection: 'row',\n    paddingLeft: 20,\n  },\n}));\n\nexport const PopupConcatOption: React.FC<IPopupConcatOptionProps> = ({\n  isOpen,\n  onClose,\n  tree,\n}) => {\n  const [subViewIdsOrder, setSubViewIdsOrder] = useState<number[]>([]);\n  const [currentOrient, setCurrentOrient] = useState<ConcatOrient>('h');\n  const [subViewsMap, setSubViewsMap] = useState({});\n  const [selectedSubViewId, setSelectedSubViewId] = useState<number | null>(\n    null\n  );\n  const classes = useStyles(currentOrient === 'h');\n\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const dispatch = useDispatch();\n\n  const handleEntering = () => {\n    const { view } = tree!.findView(operands[0])!;\n    const subViews = (view as ConcatView).getSubViews();\n    const _subViewMap = {};\n    subViews.forEach(subView => {\n      _subViewMap[subView.id] = subView;\n    });\n    setSubViewsMap(_subViewMap);\n    setSubViewIdsOrder(subViews.map(subViews => subViews.id));\n    setCurrentOrient((view as ConcatView).getOrient());\n    setSelectedSubViewId(null);\n  };\n\n  const handleOrientChange = event => {\n    setCurrentOrient(event.target.checked ? 'h' : 'v');\n  };\n\n  const handleMoveFront = () => {\n    for (let i = 1; i < subViewIdsOrder.length; i++) {\n      if (subViewIdsOrder[i] === selectedSubViewId) {\n        const newOrder = [...subViewIdsOrder];\n        newOrder[i - 1] = subViewIdsOrder[i];\n        newOrder[i] = subViewIdsOrder[i - 1];\n        setSubViewIdsOrder(newOrder);\n        return;\n      }\n    }\n  };\n\n  const handleMoveBack = () => {\n    for (let i = 0; i < subViewIdsOrder.length - 1; i++) {\n      if (subViewIdsOrder[i] === selectedSubViewId) {\n        const newOrder = [...subViewIdsOrder];\n        newOrder[i + 1] = subViewIdsOrder[i];\n        newOrder[i] = subViewIdsOrder[i + 1];\n        setSubViewIdsOrder(newOrder);\n        return;\n      }\n    }\n  };\n\n  const handleRemove = () => {\n    setSubViewIdsOrder(\n      subViewIdsOrder.filter(subView => subView !== selectedSubViewId)\n    );\n    setSelectedSubViewId(null);\n  };\n\n  const handleConcat = () => {\n    dispatch({\n      type: 'rearrange-subview',\n      operand: operands[0],\n      order: subViewIdsOrder,\n      orient: currentOrient,\n    });\n    onClose();\n  };\n\n  const operateDisabled = subViewIdsOrder.length === 0;\n\n  return (\n    <Dialog\n      open={isOpen}\n      onEntering={handleEntering}\n      aria-labelledby=\"concat-dialog-title\"\n    >\n      <DialogTitle id=\"concat-dialog-title\">\n        <>Concat</>\n        <IconButton\n          onClick={onClose}\n          style={{ right: 10, top: 7, position: 'absolute' }}\n        >\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Rearrange or remove sub views. Or change concat orientation.\n        </DialogContentText>\n        <div className={classes.views}>\n          {subViewIdsOrder.map(subView => (\n            <ViewPreview\n              view={subViewsMap[subView] as View}\n              selectedSubViewId={selectedSubViewId}\n              setSelectedSubViewId={setSelectedSubViewId}\n            />\n          ))}\n        </div>\n      </DialogContent>\n      <DialogActions className={classes.actions}>\n        <div>\n          {'v'}\n          <Switch\n            checked={currentOrient === 'h'}\n            onChange={handleOrientChange}\n            color=\"default\"\n            inputProps={{ 'aria-label': 'checkbox with default color' }}\n          />\n          {'h'}\n        </div>\n        <div>\n          <IconButton\n            disabled={\n              selectedSubViewId === null ||\n              selectedSubViewId === subViewIdsOrder[0]\n            }\n            onClick={handleMoveFront}\n          >\n            {currentOrient === 'h' ? <ArrowBack /> : <ArrowUpward />}\n          </IconButton>\n          <IconButton\n            disabled={\n              selectedSubViewId === null ||\n              selectedSubViewId === subViewIdsOrder[subViewIdsOrder.length - 1]\n            }\n            onClick={handleMoveBack}\n          >\n            {currentOrient === 'h' ? <ArrowForward /> : <ArrowDownward />}\n          </IconButton>\n        </div>\n        <div>\n          <Button\n            onClick={handleRemove}\n            color=\"secondary\"\n            disabled={selectedSubViewId === null || subViewIdsOrder.length <= 1}\n          >\n            Remove\n          </Button>\n          <Button onClick={handleConcat} autoFocus disabled={operateDisabled}>\n            Concat\n          </Button>\n        </div>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","import React, { useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport {\n  Dialog,\n  DialogTitle,\n  IconButton,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n} from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport ArrowUpward from '@material-ui/icons/ArrowUpward';\nimport ArrowDownward from '@material-ui/icons/ArrowDownward';\nimport { ViewPreview } from './ViewPreview';\nimport { LayerView } from '../../SyntaxTree/LayerView';\nimport makeStyles from '@material-ui/styles/makeStyles';\n\nexport interface IPopupLayerOptionProps {\n  isOpen: boolean;\n  onClose: () => void;\n  tree: View | null;\n}\n\nconst useStyles = makeStyles(() => ({\n  views: {\n    display: 'flex',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  actions: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    flexDirection: 'row',\n    paddingLeft: 20,\n  },\n}));\n\nexport const PopupLayerOption: React.FC<IPopupLayerOptionProps> = ({\n  isOpen,\n  onClose,\n  tree,\n}) => {\n  const classes = useStyles();\n  const [subViewIdsOrder, setSubViewIdsOrder] = useState<number[]>([]);\n  const [subViewsMap, setSubViewsMap] = useState({});\n  const [selectedSubViewId, setSelectedSubViewId] = useState<number | null>(\n    null\n  );\n\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const dispatch = useDispatch();\n\n  const handleEntering = () => {\n    const { view } = tree!.findView(operands[0])!;\n    const subViews = (view as LayerView).getSubViews();\n    const _subViewMap = {};\n    subViews.forEach(subView => {\n      _subViewMap[subView.id] = subView;\n    });\n    setSubViewsMap(_subViewMap);\n    setSubViewIdsOrder(subViews.map(subViews => subViews.id));\n    setSelectedSubViewId(null);\n  };\n\n  const handleMoveFront = () => {\n    for (let i = 1; i < subViewIdsOrder.length; i++) {\n      if (subViewIdsOrder[i] === selectedSubViewId) {\n        const newOrder = [...subViewIdsOrder];\n        newOrder[i - 1] = subViewIdsOrder[i];\n        newOrder[i] = subViewIdsOrder[i - 1];\n        setSubViewIdsOrder(newOrder);\n        return;\n      }\n    }\n  };\n\n  const handleMoveBack = () => {\n    for (let i = 0; i < subViewIdsOrder.length - 1; i++) {\n      if (subViewIdsOrder[i] === selectedSubViewId) {\n        const newOrder = [...subViewIdsOrder];\n        newOrder[i + 1] = subViewIdsOrder[i];\n        newOrder[i] = subViewIdsOrder[i + 1];\n        setSubViewIdsOrder(newOrder);\n        return;\n      }\n    }\n  };\n\n  const handleRemove = () => {\n    setSubViewIdsOrder(\n      subViewIdsOrder.filter(subView => subView !== selectedSubViewId)\n    );\n    setSelectedSubViewId(null);\n  };\n\n  const handleLayer = () => {\n    dispatch({\n      type: 'rearrange-subview',\n      operand: operands[0],\n      order: subViewIdsOrder,\n    });\n    onClose();\n  };\n\n  const operateDisabled = subViewIdsOrder.length === 0;\n\n  return (\n    <Dialog\n      open={isOpen}\n      onEntering={handleEntering}\n      aria-labelledby=\"layer-dialog-title\"\n    >\n      <DialogTitle id=\"layer-dialog-title\">\n        <>Layer</>\n        <IconButton\n          onClick={onClose}\n          style={{ right: 10, top: 7, position: 'absolute' }}\n        >\n          <Close />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>Rearrange or remove sub views.</DialogContentText>\n        <div className={classes.views}>\n          {subViewIdsOrder.map(subView => (\n            <ViewPreview\n              view={subViewsMap[subView] as View}\n              selectedSubViewId={selectedSubViewId}\n              setSelectedSubViewId={setSelectedSubViewId}\n            />\n          ))}\n        </div>\n      </DialogContent>\n      <DialogActions className={classes.actions}>\n        <div>\n          <IconButton\n            disabled={\n              selectedSubViewId === null ||\n              selectedSubViewId === subViewIdsOrder[0]\n            }\n            onClick={handleMoveFront}\n          >\n            <ArrowUpward />\n          </IconButton>\n          <IconButton\n            disabled={\n              selectedSubViewId === null ||\n              selectedSubViewId === subViewIdsOrder[subViewIdsOrder.length - 1]\n            }\n            onClick={handleMoveBack}\n          >\n            <ArrowDownward />\n          </IconButton>\n        </div>\n        <div>\n          <Button\n            onClick={handleRemove}\n            color=\"secondary\"\n            disabled={selectedSubViewId === null || subViewIdsOrder.length <= 1}\n          >\n            Remove\n          </Button>\n          <Button onClick={handleLayer} autoFocus disabled={operateDisabled}>\n            Layer\n          </Button>\n        </div>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","import React, { useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Edit from '@material-ui/icons/Edit';\nimport { IOperationProps } from '../OperationBar';\nimport { PopupFacetOption } from '../popups/PopupFacetOption';\nimport { PopupRepeatOption } from '../popups/PopupRepeatOption';\nimport { RepeatView } from '../../SyntaxTree/RepeatView';\nimport { FacetView } from '../../SyntaxTree/FacetView';\nimport { PopupConcatOption } from '../popups/PopupConcatOption';\nimport { PopupLayerOption } from '../popups/PopupLayerOption';\n\nexport interface IEditButtonProps {}\n\nexport const EditButton: React.FC<IOperationProps & IEditButtonProps> = ({\n  navBarOperands,\n  mainViewOperands,\n  tree,\n}) => {\n  const [isLayerPopupOpen, setIsLayerPopupOpen] = useState(false);\n  const [isConcatPopupOpen, setIsConcatPopupOpen] = useState(false);\n  const [isRepeatPopupOpen, setIsRepeatPopupOpen] = useState(false);\n  const [isFacetPopupOpen, setIsFacetPopupOpen] = useState(false);\n\n  const [currentView, setCurrentView] = useState<View | null>(null);\n  const setters = {\n    layer: setIsLayerPopupOpen,\n    concat: setIsConcatPopupOpen,\n    repeat: setIsRepeatPopupOpen,\n    facet: setIsFacetPopupOpen,\n    unit: () => {\n      alert('Edit is currently not working for unit spec');\n    },\n  };\n\n  const exportDisabled =\n    mainViewOperands.length !== 1 ||\n    navBarOperands.length !== 0 ||\n    tree === null;\n\n  const handleClick = () => {\n    const { view } = tree!.findView(mainViewOperands[0])!;\n    setCurrentView(view);\n    setters[view.type](true);\n  };\n\n  return (\n    <>\n      <Button disabled={exportDisabled} onClick={handleClick}>\n        <Edit /> &nbsp; Edit\n      </Button>\n      <PopupLayerOption\n        isOpen={isLayerPopupOpen}\n        onClose={() => setters.layer(false)}\n        tree={tree!}\n      />\n      <PopupConcatOption\n        isOpen={isConcatPopupOpen}\n        onClose={() => setters.concat(false)}\n        tree={tree!}\n      />\n      <PopupRepeatOption\n        isOpen={isRepeatPopupOpen}\n        onClose={() => setters.repeat(false)}\n        currentRepeat={\n          currentView instanceof RepeatView ? currentView.getInfo() : undefined\n        }\n      />\n      <PopupFacetOption\n        isOpen={isFacetPopupOpen}\n        onClose={() => setters.facet(false)}\n        currentFacet={\n          currentView instanceof FacetView ? currentView.getInfo() : undefined\n        }\n      />\n    </>\n  );\n};\n","import React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport Undo from '@material-ui/icons/Undo';\nimport Redo from '@material-ui/icons/Redo';\nimport Grid from '@material-ui/core/Grid';\nimport { LayerButton } from './operations/LayerButton';\nimport { ConcatButton } from './operations/ConcatButton';\nimport { RepeatButton } from './operations/RepeatButton';\nimport { FacetButton } from './operations/FacetButton';\nimport { PlaceButton } from './operations/PlaceButton';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { ExportButton } from './operations/ExportButton';\nimport { EditButton } from './operations/EditButton';\n\nexport interface IOperationProps {\n  navBarOperands: number[];\n  mainViewOperands: number[];\n  tree?: View | null;\n}\n\nexport const useWarningStyles = makeStyles(() => ({\n  buttonNormal: {},\n  buttonWarn: {\n    '&:hover': {\n      backgroundColor: '#ffd800',\n    },\n  },\n  error: {\n    width: 22,\n    height: 22,\n    color: '#ed1c1c',\n  },\n}));\n\nexport const OperationBar: React.FC = () => {\n  const dispatch = useDispatch();\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const tree = useSelector((state: IGlobalState) => state.current.tree);\n  const undoDisabled = useSelector(\n    (state: IGlobalState) => state.undoStack.length === 0\n  );\n  const redoDisabled = useSelector(\n    (state: IGlobalState) => state.redoStack.length === 0\n  );\n\n  const handleUndo = () => dispatch({ type: 'undo' });\n  const handleRedo = () => dispatch({ type: 'redo' });\n\n  const navBarOperands = operands.filter(x => x < 0);\n  const mainViewOperands = operands.filter(x => x > 0);\n\n  return (\n    <Grid container justify=\"space-between\">\n      <Grid item>\n        <LayerButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n        />\n        <ConcatButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n        />\n        <RepeatButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n          tree={tree}\n        />\n        <FacetButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n          tree={tree}\n        />\n        <PlaceButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n        />\n      </Grid>\n      <Grid item>\n        <Button onClick={handleUndo} disabled={undoDisabled}>\n          <Undo /> &nbsp; Undo\n        </Button>\n        <Button onClick={handleRedo} disabled={redoDisabled}>\n          <Redo /> &nbsp; Redo\n        </Button>\n        &nbsp; &nbsp;\n        <EditButton\n          navBarOperands={navBarOperands}\n          mainViewOperands={mainViewOperands}\n          tree={tree}\n        />\n        &nbsp; &nbsp;\n        <ExportButton tree={tree} />\n      </Grid>\n    </Grid>\n  );\n};\n","import { View, CompositeView } from './View';\nimport { moveElement, findViewInArray, replaceViewInArray } from './Utils';\n\nexport class ConcatView extends CompositeView<View> {\n  private concat: View[];\n  private orient: ConcatOrient;\n\n  public constructor(orient: ConcatOrient) {\n    super('concat');\n    this.concat = [];\n    this.orient = orient;\n  }\n\n  public export() {\n    return { [this.orient + 'concat']: this.concat.map(l => l.export()) };\n  }\n\n  public append(view: View) {\n    this.concat.push(view);\n  }\n\n  public prepend(view: View) {\n    this.concat.unshift(view);\n  }\n\n  public remove(index: number) {\n    this.concat.splice(index, 1);\n  }\n\n  public isCompatible(_: View): boolean {\n    // concat is always compatible\n    return true;\n  }\n\n  public rearrange(from: number, to: number) {\n    moveElement(this.concat, from, to);\n  }\n\n  public clone() {\n    const cloned = new ConcatView(this.orient);\n    cloned._id = this._id;\n    cloned.concat = [...this.concat];\n    return cloned;\n  }\n\n  public deepClone() {\n    const cloned = new ConcatView(this.orient);\n    cloned._id = this._id;\n    cloned.concat = this.concat.map(view => view.deepClone());\n    return cloned;\n  }\n\n  public findView(id: number) {\n    return findViewInArray(id, this.concat, this);\n  }\n\n  public replaceChild(view: View, id: number) {\n    return replaceViewInArray(view, this.concat, id);\n  }\n\n  public getSubViews(): View[] {\n    return [...this.concat];\n  }\n\n  public getOrient() {\n    return this.orient;\n  }\n\n  public changeOrientation(orient: ConcatOrient) {\n    this.orient = orient;\n  }\n}\n","import { createStore } from 'redux';\nimport * as R from 'ramda';\nimport { UnitView, CompositeView } from './SyntaxTree/View';\nimport { assertNever } from './utils';\nimport { LayerView } from './SyntaxTree/LayerView';\nimport { View } from './SyntaxTree/View';\nimport { ConcatView } from './SyntaxTree/ConcatView';\nimport { RepeatView, RepeatInfo } from './SyntaxTree/RepeatView';\nimport { FacetView, FacetInfo } from './SyntaxTree/FacetView';\n\nconst newGlobalState = (\n  oldState: IGlobalState,\n  getCurrent: (current: IState) => IState\n) => {\n  return {\n    current: getCurrent(oldState.current),\n    undoStack: R.prepend(oldState.current, oldState.undoStack),\n    redoStack: [],\n  };\n};\n\nconst initialState: IGlobalState = {\n  current: {\n    specs: [],\n    lastSpecId: -1,\n    operands: [],\n    tree: null,\n  },\n  undoStack: [],\n  redoStack: [],\n};\n\nconst reducer = (globalState = initialState, action: Action): IGlobalState => {\n  switch (action.type) {\n    case 'add-spec':\n      return newGlobalState(globalState, ({ specs, lastSpecId, ...rest }) => ({\n        specs: R.append(\n          { id: lastSpecId, spec: action.json, alias: action.alias },\n          specs\n        ),\n        lastSpecId: lastSpecId - 1,\n        ...rest,\n      }));\n\n    case 'modify-spec':\n      return newGlobalState(\n        globalState,\n        R.over(\n          R.lensProp('specs'),\n          R.map((spec: IBaseSpec) =>\n            spec.id === action.id\n              ? { id: action.id, spec: action.json, alias: action.alias }\n              : spec\n          )\n        )\n      );\n    case 'delete-spec':\n      return newGlobalState(\n        globalState,\n        R.pipe(\n          R.over(\n            R.lensProp('specs'),\n            R.filter((spec: IBaseSpec) => spec.id !== action.id)\n          ),\n          R.over(R.lensProp('operands'), (operands: number[]) =>\n            operands.filter(id => id !== action.id)\n          )\n        )\n      );\n    case 'undo': {\n      const { current, undoStack, redoStack } = globalState;\n      if (undoStack.length > 0) {\n        return {\n          redoStack: R.prepend(current, redoStack),\n          current: undoStack[0],\n          undoStack: undoStack.slice(1),\n        };\n      } else {\n        return globalState;\n      }\n    }\n    case 'redo': {\n      const { current, undoStack, redoStack } = globalState;\n      if (redoStack.length > 0) {\n        return {\n          redoStack: redoStack.slice(1),\n          current: redoStack[0],\n          undoStack: R.prepend(current, undoStack),\n        };\n      } else {\n        return globalState;\n      }\n    }\n    case 'select-operand': {\n      return newGlobalState(\n        globalState,\n        R.over(R.lensProp('operands'), operands => {\n          if (operands.includes(action.operand)) {\n            return R.without([action.operand], operands);\n          } else {\n            return R.append(\n              action.operand,\n              operands.filter(operand => operand * action.operand < 0)\n            );\n          }\n        })\n      );\n    }\n    case 'operate': {\n      return newGlobalState(\n        globalState,\n        R.pipe(\n          R.over(R.lensProp('tree'), (tree: View) => {\n            const findInNav = (id: number) =>\n              globalState.current.specs.find(spec => spec.id === id)!.spec;\n\n            const left = action.operands.filter(id => id < 0);\n            const right = action.operands.filter(id => id > 0);\n\n            if (action.operator === 'place') {\n              return new UnitView(findInNav(left[0]));\n            }\n\n            let newTree = tree.deepClone();\n            const rightViewResult = newTree.findView(right[0]);\n            if (rightViewResult === null) {\n              throw new Error(\n                `Cannot find view in MainView with id=${right[0]}`\n              );\n            }\n\n            let { parent, view } = rightViewResult;\n\n            switch (action.operator) {\n              case 'layer': {\n                const leftView = new UnitView(findInNav(left[0]));\n                const oldViewId = view.id;\n                if (view instanceof UnitView) {\n                  const layer = new LayerView();\n                  layer.append(view);\n                  view = layer;\n                }\n                (view as LayerView)[action.extra](leftView);\n                if (parent) {\n                  parent.replaceChild(view, oldViewId);\n                } else {\n                  newTree = view;\n                }\n                break;\n              }\n              case 'concat': {\n                const leftView = new UnitView(findInNav(left[0]));\n                const oldViewId = view.id;\n                const { orient, option } = action.extra;\n\n                if (\n                  !(view instanceof ConcatView) ||\n                  view.getOrient() !== orient\n                ) {\n                  const concat = new ConcatView(orient);\n                  concat.append(view);\n                  view = concat;\n                }\n                (view as ConcatView)[option](leftView);\n                if (parent) {\n                  parent.replaceChild(view, oldViewId);\n                } else {\n                  newTree = view;\n                }\n                break;\n              }\n              case 'repeat':\n                const repeat = new RepeatView(view, action.extra as RepeatInfo);\n                if (parent) {\n                  parent.replaceChild(repeat, view.id);\n                } else {\n                  newTree = repeat;\n                }\n                break;\n              case 'facet':\n                const facet = new FacetView(view, action.extra as FacetInfo);\n                if (parent) {\n                  parent.replaceChild(facet, view.id);\n                } else {\n                  newTree = facet;\n                }\n                break;\n              case 'replace':\n                const leftView = new UnitView(findInNav(left[0]));\n                if (parent) {\n                  parent.replaceChild(leftView, view.id);\n                } else {\n                  newTree = leftView;\n                }\n                break;\n              default:\n                return assertNever(action.operator);\n            }\n            return newTree;\n          }),\n          R.over(R.lensProp('operands'), R.always([]))\n        )\n      );\n    }\n    case 'decompose': {\n      return newGlobalState(\n        globalState,\n        R.pipe(\n          R.over(R.lensProp('tree'), tree => {\n            let newTree = (tree as View).deepClone();\n            const { parent, view } = newTree.findView(action.operand)!;\n            if (view instanceof CompositeView) {\n              const [subView] = view.getSubViews();\n              if (parent) {\n                parent.replaceChild(subView, action.operand);\n              } else {\n                newTree = subView;\n              }\n            }\n            return newTree;\n          }),\n          R.over(R.lensProp('operands'), R.always([]))\n        )\n      );\n    }\n    case 'modify-info': {\n      return newGlobalState(\n        globalState,\n        R.pipe(\n          R.over(R.lensProp('tree'), tree => {\n            let newTree = (tree as View).deepClone();\n            const { view } = newTree.findView(action.operand)!;\n            if (view instanceof FacetView) {\n              view.changeInfo(action.info);\n            } else if (view instanceof RepeatView) {\n              view.changeInfo(action.info);\n            }\n            return newTree;\n          }),\n          R.over(R.lensProp('operands'), R.always([]))\n        )\n      );\n    }\n    case 'rearrange-subview': {\n      return newGlobalState(\n        globalState,\n        R.pipe(\n          R.over(R.lensProp('tree'), tree => {\n            let newTree = (tree as View).deepClone();\n            const { parent, view } = newTree.findView(action.operand)!;\n            if (view instanceof ConcatView || view instanceof LayerView) {\n              const newView =\n                view instanceof LayerView\n                  ? new LayerView()\n                  : new ConcatView(action.orient ? action.orient : 'h');\n\n              const subViewMap = {};\n              view\n                .getSubViews()\n                .forEach(subView => (subViewMap[subView.id] = subView));\n\n              action.order.forEach(subViewId => {\n                if (subViewId in subViewMap) {\n                  newView.append(subViewMap[subViewId]);\n                } else {\n                  console.error('subViewId is not in subViewMap');\n                }\n              });\n\n              if (parent) {\n                parent.replaceChild(newView, action.operand);\n              } else {\n                newTree = newView;\n              }\n            }\n            return newTree;\n          }),\n          R.over(R.lensProp('operands'), R.always([]))\n        )\n      );\n    }\n    default:\n      return globalState;\n  }\n};\n\n// NOTE: invariants: navbar has negative id\n// and view has positive id\n\nexport const store = createStore<IGlobalState, Action, {}, {}>(reducer);\n","import React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { render } from './views/Renderer';\nimport { FacetView } from '../SyntaxTree/FacetView';\nimport { RepeatView } from '../SyntaxTree/RepeatView';\nimport { Switch } from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  main: {\n    backgroundColor: theme.palette.grey[200],\n    marginTop: theme.spacing(1),\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    width: '100%',\n  },\n  emptyView: {\n    color: 'darkgrey',\n    fontSize: 20,\n  },\n}));\n\nexport const InnerViewNavigator: React.FC = () => {\n  const classes = useStyles();\n  const [toShowInner, setToShowInner] = useState(false);\n  const tree = useSelector((state: IGlobalState) => state.current.tree);\n  const operands = useSelector((state: IGlobalState) => state.current.operands);\n  const mainViewOperands = operands.filter(x => x > 0);\n\n  const findResult =\n    !!tree &&\n    mainViewOperands.length === 1 &&\n    tree.findView(mainViewOperands[0]);\n  const currentView = !!findResult && findResult.view;\n\n  const handleSwitchChange = event => setToShowInner(event.target.checked);\n\n  return (\n    <>\n      <div style={{ height: 37 }}>\n        Inner View Navigator\n        <Switch checked={toShowInner} onChange={handleSwitchChange} />\n      </div>\n      <div className={classes.main}>\n        {!!currentView && toShowInner ? (\n          render(\n            currentView instanceof RepeatView ||\n              currentView instanceof FacetView\n              ? (currentView as RepeatView | FacetView).getSubViews()[0]\n              : currentView\n          )\n        ) : (\n          <div className={classes.emptyView}>\n            {toShowInner ? 'No View Selected' : 'Disabled'}\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n","import React from 'react';\nimport { hot } from 'react-hot-loader';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { NavigationBar } from './components/NavigationBar';\nimport { NewSpec } from './components/NewSpec';\nimport { MainView } from './components/MainView';\nimport { OperationBar } from './components/OperationBar';\nimport { sidebarWidth } from './variables';\nimport { Provider } from 'react-redux';\nimport { store } from './store';\nimport { InnerViewNavigator } from './components/InnerSpecNevigator';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    minHeight: 540,\n    display: 'flex',\n  },\n  left: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    width: sidebarWidth,\n    marginRight: theme.spacing(1),\n  },\n  center: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  right: {\n    display: 'flex',\n    flexDirection: 'column',\n    minWidth: sidebarWidth * 2,\n    alignItems: 'center',\n  },\n}));\n\nconst App: React.FC = () => {\n  const classes = useStyles();\n\n  return (\n    <Provider store={store}>\n      <div className={classes.root}>\n        <div className={classes.left}>\n          <NewSpec />\n          <NavigationBar />\n        </div>\n        <div className={classes.center}>\n          <OperationBar />\n          <MainView />\n        </div>\n        &nbsp;\n        <div className={classes.right}>\n          <InnerViewNavigator />\n        </div>\n      </div>\n    </Provider>\n  );\n};\n\nexport default hot(module)(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}